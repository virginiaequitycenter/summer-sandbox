---
title: "National Walkability Index"
author: "Helena Lindsay"
date: "7/20/2021"
output:
  html_document: 
    toc: TRUE
    toc_float: TRUE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
Data Source: https://www.epa.gov/smartgrowth/smart-location-mapping#walkability
More Information on Dataset: https://www.epa.gov/sites/default/files/2021-06/documents/national_walkability_index_methodology_and_user_guide_june2021.pdf


The National Walkability Index is a nationwide geographic data resource that ranks block groups according to their relative walkability. The Index is based on measures of the built environment that affect the probability of whether people walk as a mode of transportation: street intersection density, proximity to transit stops, and diversity of land uses.

The dataset includes walkability scores for all block groups as well as the underlying attributes that are used to rank the block groups. The walkability scores are calculated based on a simple formula that ranks selected indicators from the Smart Location Database that have been demonstrated to affect the propensity of walk trips. 

Currently, the National Walkability Index dataset ranks each block group relative to all other block groups in the United States, but individuals can use downloadable data and the "how-to" document to construct an index for a smaller universe of block groups, like a state, metropolitan area, or city.


## Variable Description {.tabset}

* D3B [Street intersection density (pedestrian-oriented intersections). Higher intersection density is correlated with more walk trips.]

* D4A [Predicted commute mode split - proportion of workers in the block group who carpool. (replaced -99999.00 with NA)]

* D2B_E8MIXA [The mix of employment types in a block group (such as retail, office, or industrial). Higher values correlate with more walk trips.]

* D2A_EPHHM [The mix of employment types and occupied housing. A block group with a diverse set of employment types (such as office, retail, and service) plus a large quantity of occupied housing units will have a relatively high value. Higher values correlate with more walk trips.]

* D2A_Ranked [Resulting rank of block group for D2A_EPHHM within all block groups. Range from 1-20, higher ranks indicate more walk trip likelihood.]

* D2B_Ranked [Resulting rank of block group for D2B_E8MIXA within all block groups. Range from 1-20, higher ranks indicate more walk trip likelihood.] 

* D3B_Ranked [Resulting rank of block group for D3B within all block groups. Range from 1-20, higher ranks indicate more walk trip likelihood.]

* D4A_Ranked [Resulting rank of block group for D4A within all block groups. Range from 1-20, higher ranks indicate more walk trip likelihood.]

* NatWalkInd  [National Walkability Index score. Calculated by weighted formula using results of indicator rank scores.]






```{r, message=F, warning=F}
library(tidyverse)
library(knitr)
library(ggplot2)
library(stargazer)
# smart location database: https://www.epa.gov/smartgrowth/smart-location-mapping#SLD

url <- ("https://edg.epa.gov/EPADataCommons/public/OA/EPA_SmartLocationDatabase_V3_Jan_2021_Final.csv")

cvillefips <- c("540", "003", "065", "079", "109", "125")
vars = c("D3B", "D4A", "D2B_E8MIXA", "D2A_EPHHM", "D2A_Ranked", "D2B_Ranked", "D3B_Ranked", "D4A_Ranked", "NatWalkInd", "GEOID10", "GEOID20", "STATEFP", "COUNTYFP", "TRACTCE", "BLKGRPCE")

```

```{r, include=FALSE}
cville_walk <- read_csv(url)%>%
  filter(STATEFP == 51) %>%
  filter(COUNTYFP %in% cvillefips)

cville_walk <- cville_walk %>%
    dplyr::select(vars)

cville_walk <- na_if(cville_walk, -99999.00)

```





## Analysis {.tabset}
### National Walkability Index score {.tabset}
National Walkability Index score. Calculated by weighted formula using results of indicator rank scores.


#### County
```{r, message=F, warning=F}
cville_walk%>%
  ggplot(aes(x = NatWalkInd)) + 
    geom_histogram() + 
    facet_wrap(~COUNTYFP)+
    theme(strip.background = element_blank())
```

```{r, include=F}
cville_walk$COUNTYFP <- as.integer(cville_walk$COUNTYFP)
cville_walk$NatWalkInd <- as.numeric(cville_walk$NatWalkInd)
cville_walk$COUNTYFP[cville_walk$COUNTYFP == 109] <- 1
cville_walk$COUNTYFP[cville_walk$COUNTYFP == 125] <- 2
cville_walk$COUNTYFP[cville_walk$COUNTYFP == 540] <- 3
```

```{r, message=F, warning=FALSE}
ggplot(cville_walk, aes(x=COUNTYFP, y=NatWalkInd)) +
        geom_point(shape=1) +
  geom_density_2d_filled(size = 0.25, alpha = 0.5)+
  scale_x_discrete(cville_walk$COUNTYFP, name ="COUNTYFP", labels= c("1" = "109", "2" ="125", "3" ="540"), breaks=c(1, 2, 3))

```

```{r, message=F, warning=F, include=F}
cville_walk$COUNTYFP[cville_walk$COUNTYFP == 1] <- 109
cville_walk$COUNTYFP[cville_walk$COUNTYFP == 2] <- 125
cville_walk$COUNTYFP[cville_walk$COUNTYFP == 3] <- 540

i = cville_walk$COUNTYFP
means = c()
for ( i in cvillefips){
  means[[i]] <- cville_walk %>%
    filter(COUNTYFP ==i)%>%
    ungroup()%>%
    select(NatWalkInd)%>%
    unlist()%>%
    mean()%>%
    round(3)
  means <- as.data.frame(means)
}
colnames(means)[1] <- "540"
rownames(means) <- "Mean_NatWalkInd"
```

```{r, warning=F, message=F, echo=F}
kable(means, format = "markdown")

# barplot

```


```{r, warning=F, message=F, echo=F}
cvlfips <- c(540,109,125)
i = cville_walk$COUNTYFP
sum = c()
for (i in cvlfips){
  sum[[i]]<-cville_walk %>% 
    filter(COUNTYFP==i)%>%
    select(D3B:NatWalkInd) %>% 
    select(where(~is.numeric(.x)))
  
  sum[[i]] %>% 
    as.data.frame() %>% 
    stargazer(., type = "text", title = paste("Summary Statistics",i), digits = 2,
            summary.stat = c("mean", "sd", "min", "median", "max"))
}

```


#### Tract

```{r, message=F, warning=F}
cville_walk%>%
  ggplot(aes(x = NatWalkInd)) + 
    geom_histogram() + 
    facet_wrap(~TRACTCE)+
    theme(strip.background = element_blank())

```

```{r, include=F}
cville_walk$TRACTCE
cville_walk$NatWalkInd <- as.numeric(cville_walk$NatWalkInd)
cville_walk$TRACTCE[cville_walk$TRACTCE == 201] <- 1
cville_walk$TRACTCE[cville_walk$TRACTCE == 202] <- 2
cville_walk$TRACTCE[cville_walk$TRACTCE == 302] <- 3
cville_walk$TRACTCE[cville_walk$TRACTCE == 401] <- 4
cville_walk$TRACTCE[cville_walk$TRACTCE == 402] <- 5
cville_walk$TRACTCE[cville_walk$TRACTCE == 501] <- 6
cville_walk$TRACTCE[cville_walk$TRACTCE == 502] <- 7
cville_walk$TRACTCE[cville_walk$TRACTCE == 600] <- 8
cville_walk$TRACTCE[cville_walk$TRACTCE == 700] <- 9
cville_walk$TRACTCE[cville_walk$TRACTCE == 800] <- 10
cville_walk$TRACTCE[cville_walk$TRACTCE == 900] <- 11
cville_walk$TRACTCE[cville_walk$TRACTCE == 1000] <- 12
cville_walk$TRACTCE[cville_walk$TRACTCE == 950100] <- 13
cville_walk$TRACTCE[cville_walk$TRACTCE == 950200] <- 14
cville_walk$TRACTCE[cville_walk$TRACTCE == 950201] <- 15
cville_walk$TRACTCE[cville_walk$TRACTCE == 950202] <- 16
cville_walk$TRACTCE[cville_walk$TRACTCE == 950300] <- 17
cville_walk$TRACTCE[cville_walk$TRACTCE == 950400] <- 18
cville_walk$TRACTCE[cville_walk$TRACTCE == 950500] <- 19
```

```{r, message=F, warning=FALSE}
ggplot(cville_walk, aes(x=TRACTCE, y=NatWalkInd)) +
        geom_point(shape=1) +
  geom_density_2d_filled(size = 0.25, alpha = 0.5)+
  scale_x_discrete(cville_walk$TRACTCE, name ="TRACTCE", labels= c("1" = "201", "2" ="202", "3" ="302","4" = "401", "5" ="402", "6" ="501","7" = "502", "8" ="600", "9" ="700", "10" = "800", "11" ="900", "12" ="1000","13" = "950100", "14" ="950200", "15" ="950201","16" = "950202", "17" ="950300", "18" ="950400","19" ="950500"), breaks=c(1, 2, 3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19))+
  theme(axis.text.x = element_text(face="plain", color="black", 
                           size=7,angle=25))



```




```{r, message=F, warning=F, include=F}
tract <- c("201","202","302","401","402","501","502","600","700","800","900","1000","950100","950200","950201","950202","950300","950400","950500")

cville_walk$TRACTCE[cville_walk$TRACTCE == 1] <- 201
cville_walk$TRACTCE[cville_walk$TRACTCE == 2] <- 202
cville_walk$TRACTCE[cville_walk$TRACTCE == 3] <- 302
cville_walk$TRACTCE[cville_walk$TRACTCE == 4] <- 401
cville_walk$TRACTCE[cville_walk$TRACTCE == 5] <- 402
cville_walk$TRACTCE[cville_walk$TRACTCE == 6] <- 501
cville_walk$TRACTCE[cville_walk$TRACTCE == 7] <- 502
cville_walk$TRACTCE[cville_walk$TRACTCE == 8] <- 600
cville_walk$TRACTCE[cville_walk$TRACTCE == 9] <- 700
cville_walk$TRACTCE[cville_walk$TRACTCE == 10] <- 800
cville_walk$TRACTCE[cville_walk$TRACTCE ==11] <-  900
cville_walk$TRACTCE[cville_walk$TRACTCE == 12] <- 1000
cville_walk$TRACTCE[cville_walk$TRACTCE == 13] <- 950100
cville_walk$TRACTCE[cville_walk$TRACTCE == 14] <- 950200
cville_walk$TRACTCE[cville_walk$TRACTCE == 15] <- 950201
cville_walk$TRACTCE[cville_walk$TRACTCE == 16] <- 950202
cville_walk$TRACTCE[cville_walk$TRACTCE == 17] <- 950300
cville_walk$TRACTCE[cville_walk$TRACTCE == 18] <- 950400
cville_walk$TRACTCE[cville_walk$TRACTCE == 19] <- 950500

i = cville_walk$TRACTCE
means = c()
for ( i in tract){
  means[[i]] <- cville_walk %>%
    filter(TRACTCE ==i)%>%
    ungroup()%>%
    select(NatWalkInd)%>%
    unlist()%>%
    mean()%>%
    round(3)
  means <- as.data.frame(means)
}
colnames(means)[1] <- "201"
rownames(means) <- "Mean_NatWalkInd"

```

```{r, warning=F, message=F, echo=F}
kable(means, format = "markdown")
```

##### Tract
```{r, warning=F, message=F, echo=F}
i = cville_walk$TRACTCE
sum = c()
for (i in tract){
  sum[[i]]<-cville_walk %>% 
    filter(TRACTCE==i)%>%
    select(D3B:NatWalkInd) %>% 
    select(where(~is.numeric(.x)))
  
  sum[[i]] %>% 
    as.data.frame() %>% 
    stargazer(., type = "text", title = paste("Summary Statistics",i), digits = 2,
            summary.stat = c("mean", "sd", "min", "median", "max"))
}

```

