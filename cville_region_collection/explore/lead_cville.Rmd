---
title: "Low-Income Energy Affordability Data"
subtitle: "Data for Charlottesville Region"
author: "Marisa Lemma"
date: "7/21/2021"
output: 
  html_document: 
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Load libraries and data
library(tidyverse)
library(mosaic)
library(stargazer)
library(viridis)
library(leaflet)
library(rgdal)
library(sf)
library(googlesheets4)

lead <- read_csv("../data/lead_cville_tract.csv")

meta <- read_sheet("https://docs.google.com/spreadsheets/d/1nqm3DuVXD1ObbVe_deacvT7uSLdBXfQJo3mkbqDwrVo/edit#gid=1573436636", sheet="lead", gs4_deauth())

```

## Data Source

Source: Low-Income Energy Affordability Data, 2018 Update

* Download URL: https://data.openei.org/submissions/573 
* About: https://lead.openei.org/assets/files/LEAD-Tool-Methodology.pdf

### About the Data

The US Department of Energy's Low-Income Energy Affordability Data (LEAD) shows energy expenditures and energy burdens for households. This particular data, pulled from the 2018 Area Median Income data, also breaks households into income brackets. The income brackets are as a percentage of the area's median income (AMI), where 100% indicates that household income is equivalent to the AMI. The income brackets in this data are 0-30%, 30-60%, 60-80%, 80-100%, and 100%+.

## Variable Descriptions
```{r}
glimpse(lead)
```

```{r}
meta %>% 
  mutate(label = paste0(varname, ": ", about)) %>% 
  select(label) %>% 
  as.list()
```


## Summaries

Summary of all non-missing variables:

```{r, message = F}
lead %>% select(-c(FIP:tract)) %>% 
  select(where(~is.numeric(.x) && !is.na(.x))) %>% 
  as.data.frame() %>% 
  stargazer(., type = "text", title = "Summary Statistics", digits = 0,
            summary.stat = c("mean", "sd", "min", "median", "max"))
```

## Visual Distributions
Visual distributions of the data, shown with histograms and scatterplots

### Trends in Energy Burden

```{r, message = F}
lead %>% select(FIP, averageburden) %>% 
  pivot_longer(-FIP, names_to = "measure", values_to = "value") %>% 
  ggplot(aes(x = value, fill = measure)) + 
  geom_histogram() +
  xlab("Average household energy burden")
```

```{r, message = F}
lead %>% select(FIP, percentburdened) %>% 
  pivot_longer(-FIP, names_to = "measure", values_to = "value") %>% 
  ggplot(aes(x = value, fill = measure)) + 
  geom_histogram(binwidth=2) +
  xlab("Percent of households that are burdened")
```

```{r}
lead %>%
  ggplot() +
  geom_point(aes(x=extremelyhighburden, y=percentburdened)) + 
  xlab("Number of households with extremely high burden") +
  ylab("Percent of households that are burdened") +
  ggtitle("Extremely high energy burden vs. percent burdened") +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
lead %>%
  ggplot() +
  geom_point(aes(x=lowburden, y=percentburdened)) +
  xlab("Number of households with low burden") +
  ylab("Percent of households that are burdened") +
  ggtitle("Low energy burden vs. percent burdened") +
  theme(plot.title = element_text(hjust = 0.5))
```


### Trends in Energy Burden Across AMI Ranges

```{r, message = F, warning = F}
lead %>% select(FIP, percent_0_30:percent_over_100) %>% 
  pivot_longer(-FIP, names_to = "measure", values_to = "value") %>% 
  ggplot(aes(x = value, fill = measure)) + 
  geom_histogram() + 
  facet_wrap(~measure, scales = "free") +
  xlab("Percent of households burdened") +
  scale_fill_discrete(labels = c("0-30% AMI", "30-60% AMI", "60-80% AMI", "80-100% AMI", "100%+ AMI"))
```

### Trends in Energy Burden by Owning/Renting

```{r}
lead %>% select(FIP, percent_burdened_owners, percent_burdened_renters) %>% 
  pivot_longer(-FIP, names_to = "measure", values_to = "value") %>% 
  ggplot(aes(x = value, fill = measure)) + 
  geom_histogram(binwidth = 5) + 
  facet_wrap(~measure) +
  xlab("Percent of households burdened") +
  scale_fill_discrete(labels = c("Owners", "Renters"))
```

## Spatial Distributions

Maps to show the distribution of variables across spatial units

```{r, include = F}
# Open shapefile
cville_tracts <- readRDS("../data/cville_tracts.RDS")

lead <- lead %>% dplyr::rename(GEOID = FIP)

cvlshapes <- merge(cville_tracts, lead, by = 'GEOID', all.x = T)

cvlshapes <- st_transform(cvlshapes, crs = 4326) # to WGS84, given error

```


### Average Energy Burden

```{r}
pal <- colorNumeric("Blues", reverse = TRUE, domain = cvlshapes$averageburden)
leaflet(cvlshapes) %>%
  addProviderTiles("CartoDB.Positron") %>%
  addPolygons(data = cvlshapes,
              fillColor = ~pal(averageburden),
              weight = 1,
              opacity = 1,
              color = "white",
              fillOpacity = 0.6,
              highlight = highlightOptions(weight = 2, fillOpacity = 0.8, bringToFront = T),
              popup = paste0("Tract Number: ", cvlshapes$tract, "<br>",
                             "Avg. Burden: ", round(cvlshapes$averageburden, 2))) %>%
  addLegend("bottomright", pal = pal, values = cvlshapes$averageburden,
            title = "Average Energy Burden", opacity = 0.7)
  
```


### Average Yearly Household Energy Expenditures

```{r}
pal <- colorNumeric("Blues", reverse = TRUE, domain = cvlshapes$avg_hh_exp)
leaflet(cvlshapes) %>%
  addProviderTiles("CartoDB.Positron") %>%
  addPolygons(data = cvlshapes,
              fillColor = ~pal(avg_hh_exp),
              weight = 1,
              opacity = 1,
              color = "white",
              fillOpacity = 0.6,
              highlight = highlightOptions(weight = 2, fillOpacity = 0.8, bringToFront = T),
              popup = paste0("Tract Number: ", cvlshapes$tract, "<br>",
                             "Avg. Household Energy Expenditures: ", round(cvlshapes$avg_hh_exp, 2))) %>%
  addLegend("bottomright", pal = pal, values = cvlshapes$avg_hh_exp,
            title = "Average Yearly Household Energy Expenditures", opacity = 0.7)
```


### Number of Energy Burdened Households

```{r}
pal <- colorNumeric("Blues", reverse = TRUE, domain = cvlshapes$numberburdened)
leaflet(cvlshapes) %>%
  addProviderTiles("CartoDB.Positron") %>%
  addPolygons(data = cvlshapes,
              fillColor = ~pal(numberburdened),
              weight = 1,
              opacity = 1,
              color = "white",
              fillOpacity = 0.6,
              highlight = highlightOptions(weight = 2, fillOpacity = 0.8, bringToFront = T),
              popup = paste0("Tract Number: ", cvlshapes$tract, "<br>",
                             "Number Burdened: ", round(cvlshapes$numberburdened, 2))) %>%
  addLegend("bottomright", pal = pal, values = cvlshapes$numberburdened,
            title = "Number of Energy Burdened Households", opacity = 0.7)
```


### Percent of Energy Burdened Households

```{r}
pal <- colorNumeric("Blues", reverse = TRUE, domain = cvlshapes$percentburdened)
leaflet(cvlshapes) %>%
  addProviderTiles("CartoDB.Positron") %>%
  addPolygons(data = cvlshapes,
              fillColor = ~pal(percentburdened),
              weight = 1,
              opacity = 1,
              color = "white",
              fillOpacity = 0.6,
              highlight = highlightOptions(weight = 2, fillOpacity = 0.8, bringToFront = T),
              popup = paste0("Tract Number: ", cvlshapes$tract, "<br>",
                             "Pct. Burdened: ", round(cvlshapes$percentburdened, 2), "<br>",
                             "Pct. Burdened - 0-30% AMI: ", round(cvlshapes$percent_0_30, 2), "<br>",
                             "Pct. Burdened - 30-60% AMI: ", round(cvlshapes$percent_30_60, 2), "<br>",
                             "Pct. Burdened - 60-80% AMI: ", round(cvlshapes$percent_60_80, 2), "<br>",
                             "Pct. Burdened - 80-100% AMI: ", round(cvlshapes$percent_80_100, 2), "<br>",
                             "Pct. Burdened - 100%+ AMI: ", round(cvlshapes$percent_over_100, 2))) %>%
  addLegend("bottomright", pal = pal, values = cvlshapes$percentburdened,
            title = "Percent of Energy Burdened Households", opacity = 0.7)
```

### Percent of Energy Burdened Rented Households

```{r}
pal <- colorNumeric("Blues", reverse = TRUE, domain = cvlshapes$percent_burdened_renters)
leaflet(cvlshapes) %>%
  addProviderTiles("CartoDB.Positron") %>%
  addPolygons(data = cvlshapes,
              fillColor = ~pal(percent_burdened_renters),
              weight = 1,
              opacity = 1,
              color = "white",
              fillOpacity = 0.6,
              highlight = highlightOptions(weight = 2, fillOpacity = 0.8, bringToFront = T),
              popup = paste0("Tract Number: ", cvlshapes$tract, "<br>",
                             "Pct. of Renters Burdened: ", round(cvlshapes$percent_burdened_renters, 2))) %>%
  addLegend("bottomright", pal = pal, values = cvlshapes$percent_burdened_renters,
            title = "Percent of Energy Burdened Rented Households", opacity = 0.7)
```


### Percent of Energy Burdened Owned Households

```{r}
pal <- colorNumeric("Blues", reverse = TRUE, domain = cvlshapes$percent_burdened_owners)
leaflet(cvlshapes) %>%
  addProviderTiles("CartoDB.Positron") %>%
  addPolygons(data = cvlshapes,
              fillColor = ~pal(percent_burdened_owners),
              weight = 1,
              opacity = 1,
              color = "white",
              fillOpacity = 0.6,
              highlight = highlightOptions(weight = 2, fillOpacity = 0.8, bringToFront = T),
              popup = paste0("Tract Number: ", cvlshapes$tract, "<br>",
                             "Pct. of Owners Burdened: ", round(cvlshapes$percent_burdened_owners, 2))) %>%
  addLegend("bottomright", pal = pal, values = cvlshapes$percent_burdened_owners,
            title = "Percent of Energy Burdened Owned Households", opacity = 0.7)
```

## Important Notes

Several census tracts in Charlottesville and Albemarle County are primarily composed of UVA students, which makes energy burden difficult to calculate for these areas. Students typically spend a large portion of their "income" on energy, because they typically do not make a lot of money and get most of their money from other sources.

Census tracts 109.01, 109.02, and 109.03 in Albemarle County encompass the university. Charlottesville census tracts 2.01, 2.02, and 6, while not officially university property, house primarily students.

These student-dominated census tracts look like outliers on many of the variables of interest - tract 109.03 especially stands out - but they do not capture the whole picture.