---
title: "Low-Income Energy Affordability Data"
subtitle: "Data for Charlottesville Region"
author: "Marisa Lemma"
date: "6/25/2021"
output: 
  html_document: 
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Load libraries and data
library(tidyverse)
library(mosaic)
library(stargazer)
library(viridis)
library(leaflet)
library(rgdal)
library(sf)

lead <- read_csv("~/Desktop/Equity Center/summer-sandbox/cville_region_collection/data/lead_cville_tract.csv")

```

## Data Source

Source: Low-Income Energy Affordability Data, 2018 Update

* Download URL: https://data.openei.org/submissions/573 
* About: https://lead.openei.org/assets/files/LEAD-Tool-Methodology.pdf

### About the Data

## Variable Descriptions
```{r}
glimpse(lead)
```

Observations are census tract estimates of:

* Total income (`totalinc`)
* Total expenditures on electricity, gas, and other energy sources (`totalelep`, `totalgas`, `totalother`)
* Average energy burden (`averageburden`)
  + Energy burden is defined in this data as the percentage of household income spent on energy.
* Number of households that fall in each energy burden category:
  + Low: less than 6% energy burden (`lowburden`)
  + High: 6-10% energy burden (`highburden`)
  + Very high: 10-20% energy burden (`veryhighburden`)
  + Extremely high: 20% energy burden or higher (`extremelyhighburden`)
* Total number of housing units (`totalunits`)
* Total number of energy-burdened households (`numberburdened`)
  + An energy-burdened household is one which falls in the high, very high, or extremely high categories
* Percent of households that are energy-burdened (`percentburdened`)
* Total number of households in each Area Median Income (AMI) category:
  + 0-30%: household income is between 0 and 30% of AMI (`total_0_30`)
  + 30-60%: household income is between 30 and 60% of AMI (`total_30_60`)
  + 60-80%: household income is between 60 and 80% of AMI (`total_60_80`)
  + 80-100%: household income is between 80 and 100% of AMI (`total_80_100`)
  + 100%+: household income is 100% of AMI or greater (`total_over_100`)
* Number of households in each AMI group that are energy burdened (`burdened_0_30`, `burdened_30_60`, `burdened_60_80`, `burdened_80_100`, `burdened_over_100`)
* Percent of households in each AMI group that are energy burdened (`percent_0_30`, `percent_30_60`, `percent_60_80`, `percent_80_100`, `percent_over_100`)
* Total number of households that are owned (`total_owners`)
* Total number of households that are rented (`total_renters`)
* Number of owned households that are energy burdened (`burdened_owners`)
* Number of rented households that are energy burdened (`burdened_renters`)
* Percent of owned households that are energy burdened (`percent_burdened_owners`)
* Percent of rented households that are energy burdened (`percent_burdened_renters`)

## Summaries

Summary of all non-missing variables:

```{r, message = F}
lead %>% select(-c(FIP:tract)) %>% 
  select(where(~is.numeric(.x) && !is.na(.x))) %>% 
  as.data.frame() %>% 
  stargazer(., type = "text", title = "Summary Statistics", digits = 0,
            summary.stat = c("mean", "sd", "min", "median", "max"))
```

## Visual Distributions
Visual distributions of the data, shown with histograms

### Trends in Energy Burden
```{r, message = F}
lead %>% select(FIP, averageburden) %>% 
  pivot_longer(-FIP, names_to = "measure", values_to = "value") %>% 
  ggplot(aes(x = value, fill = measure)) + 
  geom_histogram() + 
  facet_wrap(~measure, scales = "free")
```

```{r, message = F}
lead %>% select(FIP, percentburdened) %>% 
  pivot_longer(-FIP, names_to = "measure", values_to = "value") %>% 
  ggplot(aes(x = value, fill = measure)) + 
  geom_histogram(binwidth=2) + 
  facet_wrap(~measure, scales = "free")
```



### Trends in Energy Burden Across AMI Ranges
```{r, message = F, warning = F}
lead %>% select(FIP, percent_0_30:percent_over_100) %>% 
  pivot_longer(-FIP, names_to = "measure", values_to = "value") %>% 
  ggplot(aes(x = value, fill = measure)) + 
  geom_histogram() + 
  facet_wrap(~measure, scales = "free")
```

### Trends in Energy Burden by Owning/Renting

```{r}
lead %>% select(FIP, percent_burdened_owners, percent_burdened_renters) %>% 
  pivot_longer(-FIP, names_to = "measure", values_to = "value") %>% 
  ggplot(aes(x = value, fill = measure)) + 
  geom_histogram(binwidth = 5) + 
  facet_wrap(~measure, scales = "free")
```

## Spatial Distributions

Maps to show the distribution of variables across spatial units

```{r, include = F}
# Open shapefile
cville_tracts <- readOGR('/Users/marisalemma/Downloads/US_Census_Tract_Area_2010/US_Census_Tract_Area_2010.shp', GDAL1_integer64_policy = TRUE)

lead <- lead %>% dplyr::rename(Tract = FIP)

cvlshapes <- merge(cville_tracts, lead, by = 'Tract', all.x = F)

```


### Average Energy Burden

```{r}
pal <- colorNumeric("plasma", reverse = TRUE, domain = cvlshapes$averageburden)
leaflet(cvlshapes) %>%
  addProviderTiles("CartoDB.Positron") %>%
  addPolygons(data = cvlshapes,
              fillColor = ~pal(averageburden),
              weight = 1,
              opacity = 1,
              color = "white",
              fillOpacity = 0.6,
              highlight = highlightOptions(weight = 2, fillOpacity = 0.8, bringToFront = T),
              popup = paste0("Tract Number: ", cvlshapes$tract, "<br>",
                             "Avg. Burden: ", round(cvlshapes$averageburden, 2))) %>%
  addLegend("bottomright", pal = pal, values = cvlshapes$averageburden,
            title = "Average Energy Burden", opacity = 0.7)
  
```


### Number of Energy Burdened Households

```{r}
pal <- colorNumeric("plasma", reverse = TRUE, domain = cvlshapes$numberburdened)
leaflet(cvlshapes) %>%
  addProviderTiles("CartoDB.Positron") %>%
  addPolygons(data = cvlshapes,
              fillColor = ~pal(numberburdened),
              weight = 1,
              opacity = 1,
              color = "white",
              fillOpacity = 0.6,
              highlight = highlightOptions(weight = 2, fillOpacity = 0.8, bringToFront = T),
              popup = paste0("Tract Number: ", cvlshapes$tract, "<br>",
                             "Number Burdened: ", round(cvlshapes$numberburdened, 2))) %>%
  addLegend("bottomright", pal = pal, values = cvlshapes$numberburdened,
            title = "Number of Energy Burdened Households", opacity = 0.7)
```


### Percent of Energy Burdened Households

```{r}
pal <- colorNumeric("plasma", reverse = TRUE, domain = cvlshapes$percentburdened)
leaflet(cvlshapes) %>%
  addProviderTiles("CartoDB.Positron") %>%
  addPolygons(data = cvlshapes,
              fillColor = ~pal(percentburdened),
              weight = 1,
              opacity = 1,
              color = "white",
              fillOpacity = 0.6,
              highlight = highlightOptions(weight = 2, fillOpacity = 0.8, bringToFront = T),
              popup = paste0("Tract Number: ", cvlshapes$tract, "<br>",
                             "Pct. Burdened: ", round(cvlshapes$percentburdened, 2), "<br>",
                             "Pct. Burdened - 0-30% AMI: ", round(cvlshapes$percent_0_30, 2), "<br>",
                             "Pct. Burdened - 30-60% AMI: ", round(cvlshapes$percent_30_60, 2), "<br>",
                             "Pct. Burdened - 60-80% AMI: ", round(cvlshapes$percent_60_80, 2), "<br>",
                             "Pct. Burdened - 80-100% AMI: ", round(cvlshapes$percent_80_100, 2), "<br>",
                             "Pct. Burdened - 100%+ AMI: ", round(cvlshapes$percent_over_100, 2))) %>%
  addLegend("bottomright", pal = pal, values = cvlshapes$percentburdened,
            title = "Percent of Energy Burdened Households", opacity = 0.7)
```

### Percent of Energy Burdened Rented Households

```{r}
pal <- colorNumeric("plasma", reverse = TRUE, domain = cvlshapes$percent_burdened_renters)
leaflet(cvlshapes) %>%
  addProviderTiles("CartoDB.Positron") %>%
  addPolygons(data = cvlshapes,
              fillColor = ~pal(percent_burdened_renters),
              weight = 1,
              opacity = 1,
              color = "white",
              fillOpacity = 0.6,
              highlight = highlightOptions(weight = 2, fillOpacity = 0.8, bringToFront = T),
              popup = paste0("Tract Number: ", cvlshapes$tract, "<br>",
                             "Percent of Renters Burdened: ", round(cvlshapes$percent_burdened_renters, 2))) %>%
  addLegend("bottomright", pal = pal, values = cvlshapes$percent_burdened_renters,
            title = "Percent of Energy Burdened Rented Households", opacity = 0.7)
```


### Percent of Energy Burdened Owned Households

```{r}
pal <- colorNumeric("plasma", reverse = TRUE, domain = cvlshapes$percent_burdened_owners)
leaflet(cvlshapes) %>%
  addProviderTiles("CartoDB.Positron") %>%
  addPolygons(data = cvlshapes,
              fillColor = ~pal(percent_burdened_owners),
              weight = 1,
              opacity = 1,
              color = "white",
              fillOpacity = 0.6,
              highlight = highlightOptions(weight = 2, fillOpacity = 0.8, bringToFront = T),
              popup = paste0("Tract Number: ", cvlshapes$tract, "<br>",
                             "Percent of Renters Burdened: ", round(cvlshapes$percent_burdened_owners, 2))) %>%
  addLegend("bottomright", pal = pal, values = cvlshapes$percent_burdened_owners,
            title = "Percent of Energy Burdened Owned Households", opacity = 0.7)
```

## Important Notes

Several census tracts in Charlottesville and Albemarle County are primarily composed of UVA students, which makes energy burden difficult to calculate for these areas. Students typically spend a large portion of their "income" on energy, because they typically do not make a lot of money and get most of their money from other sources. 

Census tracts 109.01, 109.02, and 109.03 in Albemarle County encompass the university. Charlottesville census tracts 2.01, 2.02, and 6, while not officially university property, house primarily students.