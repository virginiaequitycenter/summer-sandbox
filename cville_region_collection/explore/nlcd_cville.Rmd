---
title: "NLCD Data"
author: "Michele Claibourn, Helena Lindsay"
date: "9/11/2021"
output:
  html_document: 
    toc: TRUE
    toc_float: TRUE
---

```{r setup, include=FALSE, warning=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE) 
```

# Background
## Data Source

The data represented here comes form the U.S. Geological Survey National Land Cover Database, as downloaded through the Multi-Resolution Land Characteristics consortium, https://www.mrlc.gov/

Download urls:

* NLCD 2019 Land Cover: The National Land Cover Database (NLCD) provides nationwide data on land cover and land cover change at a 30m resolution with a 16-class legend based on a modified [Anderson Level II classification system](https://www.mrlc.gov/data/legends/national-land-cover-database-2019-nlcd2019-legend). Download: https://s3-us-west-2.amazonaws.com/mrlc/nlcd_2019_land_cover_l48_20210604.zip
* NLCD 2019 Impervious Surfaces: NLCD imperviousness products represent urban impervious surfaces as a percentage of developed surface over every 30-meter pixel in the United States. Download: https://s3-us-west-2.amazonaws.com/mrlc/nlcd_2019_impervious_l48_20210604.zip
* NLCD 2016 Tree Canopy: NLCD tree canopy cover is a 30 m raster geospatial dataset containing percent tree canopy estimates, as a continuous variable, for each pixel across all land covers and types and are generated by the United States Forest Service (USFS). Download: https://s3-us-west-2.amazonaws.com/mrlc/nlcd_2016_treecanopy_2019_08_31.zip


```{r}
# Load libraries
library(tidyverse)
library(leaflet)
library(sf)
#library (sp)
library(viridis)
library(raster)
library(stargazer)

# Load data
cville_tracts <- readRDS("../data/cville_tracts.RDS")
cville_blkgps <- readRDS("../data/cville_blkgps.RDS")
cville_blocks <- readRDS("../data/cville_blocks.RDS")

nlcd_cville_tracts <- read_csv("../data/nlcd_cville_tracts.csv")
nlcd_cville_blkgps <- read_csv("../data/nlcd_cville_blkgps.csv")
nlcd_cville_blocks <- read_csv("../data/nlcd_cville_blocks.csv")

# Join data to geometry
nlcd_cville_tracts <- nlcd_cville_tracts %>% 
  mutate(GEOID = as.character(GEOID)) %>% 
  dplyr::select(-c(STATEFP, COUNTYFP, TRACTCE, NAME, NAMELSAD))

cville_tracts <- left_join(cville_tracts, nlcd_cville_tracts)

nlcd_cville_blkgps <- nlcd_cville_blkgps %>% 
  mutate(GEOID = as.character(GEOID)) %>% 
  dplyr::select(-c(STATEFP, COUNTYFP, BLKGRPCE, NAMELSAD))

cville_blkgps <- left_join(cville_blkgps, nlcd_cville_blkgps)

nlcd_cville_blocks <- nlcd_cville_blocks %>% 
  mutate(GEOID10 = as.character(GEOID10)) %>% 
  dplyr::select(-c(STATEFP, COUNTYFP, TRACTCE10, BLOCKCE10, NAME10))

cville_blocks <- left_join(cville_blocks, nlcd_cville_blocks)
```

## Variable Descriptions and Summaries

Variables include: 

```{r}
glimpse(nlcd_cville_tracts)
```

* GEOID: geographic identifer for spatial area (tracts, block groups, and blocks)
* tree_can: estimated percent of spatial area with tree canopy
* imp_surf: estimated percent of spatial area with impervious surface material
* cells: number of 30m cells contained in the spatial area
* developed: number of 30m cells in a spatial unit classified as developed areas
* forest: number of 30m cells in a spatial unit classified as forest areas
* percent_dev: percent of 30m cells in a spatial unit classified as developed areas

5-number summaries of variables by blocks:

```{r}
nlcd_cville_blocks %>%  
  dplyr::select(where(~is.numeric(.x) && !is.na(.x))) %>% 
  dplyr::select(-c(cells, blocks, developed, forest)) %>% 
  as.data.frame() %>% 
  stargazer(., type = "text", title = "Summary Statistics", digits = 0,
            summary.stat = c("mean", "sd", "min", "median", "max"))
```

# Visual Distributions{.tabset}

## Tracts
```{r}
vars <- nlcd_cville_tracts %>% dplyr::select(-c(tract, cells, developed, forest)) %>% names()

nlcd_cville_tracts %>% dplyr::select(all_of(vars), GEOID) %>% 
  pivot_longer(-GEOID, names_to = "measure", values_to = "value") %>% 
  ggplot(aes(x = value, fill = measure)) + 
  geom_histogram() + 
  scale_fill_viridis(option = "viridis", discrete = TRUE, guide = FALSE) +
  facet_wrap(~measure, scales = "free")
```
  
## Block Groups
```{r}
vars <- nlcd_cville_blkgps %>% dplyr::select(-c(TRACTCE, blkgps, cells, developed, forest)) %>% names()

nlcd_cville_blkgps %>% dplyr::select(all_of(vars), GEOID) %>% 
  pivot_longer(-GEOID, names_to = "measure", values_to = "value") %>% 
  ggplot(aes(x = value, fill = measure)) + 
  geom_histogram() + 
  scale_fill_viridis(option = "viridis", discrete = TRUE, guide = FALSE) +
  facet_wrap(~measure, scales = "free")
```


## Blocks 
```{r}
vars <- nlcd_cville_blocks %>% dplyr::select(-c(blocks, cells, developed, forest)) %>% names()

nlcd_cville_blocks %>% dplyr::select(all_of(vars), GEOID10) %>% 
  pivot_longer(-GEOID10, names_to = "measure", values_to = "value") %>% 
  ggplot(aes(x = value, fill = measure)) + 
  geom_histogram() + 
  scale_fill_viridis(option = "viridis", discrete = TRUE, guide = FALSE) +
  facet_wrap(~measure, scales = "free")
```

# Maps
## Land Cover{.tabset}

Among the 11 land cover classifications, only 8 were present in the Charlottesville region. We summed the number of 30-meter cells within a spatial unit (census tract, census block group, census block) for the most frequent classifications: 

1. Developed areas -- developed-open, developed-low intenity, developed-medium intensity, developed-high intensity -- to generate the percent of developed land
2. Forest areas -- deciduous forest, evergreen forest, mixed forest -- to generate the percent of forested land

### Tracts
```{r}
pal <- colorNumeric("viridis", reverse = TRUE, domain = nlcd_cville_blocks$percent_dev)

m <- leaflet()%>%
  addTiles()%>%
  addPolygons(data = cville_tracts,
              fillColor = ~pal(percent_dev),
              weight = 1,
              opacity = 1,
              color = "white",
              fillOpacity = 0.6,
              highlight = highlightOptions(weight = 2, fillOpacity = 0.8, bringToFront = T),
              popup = paste0("FIPS Code: ", cville_tracts$GEOID, "<br>",
                             "Percent Developed: ", cville_tracts$percent_dev)) %>%
  addLegend("bottomright", pal = pal, values = cville_tracts$percent_dev,
            title = "Percent Developed Land", opacity = 0.7)
m
```

```{r}
pal <- colorNumeric("viridis", reverse = TRUE, domain = nlcd_cville_blocks$percent_for)

m <- leaflet()%>%
  addTiles()%>%
  addPolygons(data = cville_tracts,
              fillColor = ~pal(percent_for),
              weight = 1,
              opacity = 1,
              color = "white",
              fillOpacity = 0.6,
              highlight = highlightOptions(weight = 2, fillOpacity = 0.8, bringToFront = T),
              popup = paste0("FIPS Code: ", cville_tracts$GEOID, "<br>",
                             "Percent Forest: ", cville_tracts$percent_for)) %>%
  addLegend("bottomright", pal = pal, values = cville_tracts$percent_for,
            title = "Percent Forested Land", opacity = 0.7)
m
```

### Block Groups
```{r}
pal <- colorNumeric("viridis", reverse = TRUE, domain = nlcd_cville_blocks$percent_dev)

m <- leaflet()%>%
  addTiles()%>%
  addPolygons(data = cville_blkgps,
              fillColor = ~pal(percent_dev),
              weight = 0.75,
              opacity = 1,
              color = "white",
              fillOpacity = 0.6,
              highlight = highlightOptions(weight = 2, fillOpacity = 0.8, bringToFront = T),
              popup = paste0("FIPS Code: ", cville_blkgps$GEOID, "<br>",
                             "Percent Developed: ", cville_blkgps$percent_dev)) %>%
  addLegend("bottomright", pal = pal, values = cville_blkgps$percent_dev,
            title = "Percent Developed Land", opacity = 0.7)
m
```

```{r}
pal <- colorNumeric("viridis", reverse = TRUE, domain = nlcd_cville_blocks$percent_for)

m <- leaflet()%>%
  addTiles()%>%
  addPolygons(data = cville_blkgps,
              fillColor = ~pal(percent_for),
              weight = 0.75,
              opacity = 1,
              color = "white",
              fillOpacity = 0.6,
              highlight = highlightOptions(weight = 2, fillOpacity = 0.8, bringToFront = T),
              popup = paste0("FIPS Code: ", cville_blkgps$GEOID, "<br>",
                             "Percent Forest: ", cville_blkgps$percent_for)) %>%
  addLegend("bottomright", pal = pal, values = cville_blkgps$percent_for,
            title = "Percent Forested Land", opacity = 0.7)
m
```


### Blocks

Block level maps are slow to render and may be added later.


## Impervious Surfaces{.tabset}

The percent of space in each 30-meter cell covered by impervious surfaces is estimated. The measures below take the average percent of impervious surface across all of the cells within a spatial unit (census tract, census block group, census block).

### Tracts
```{r}
pal <- colorNumeric("plasma", reverse = TRUE, domain = nlcd_cville_blocks$imp_surf)

m <- leaflet()%>%
  addTiles()%>%
  addPolygons(data = cville_tracts,
              fillColor = ~pal(imp_surf),
              weight = 1,
              opacity = 1,
              color = "white",
              fillOpacity = 0.6,
              highlight = highlightOptions(weight = 2, fillOpacity = 0.8, bringToFront = T),
              popup = paste0("FIPS Code: ", cville_tracts$GEOID, "<br>",
                             "Percent Impervious Surface: ", cville_tracts$imp_surf)) %>%
  addLegend("bottomright", pal = pal, values = cville_tracts$imp_surf,
            title = "Average Percent Imperviuos Surface", opacity = 0.7)
m
```

### Block Groups
```{r}
pal <- colorNumeric("plasma", reverse = TRUE, domain = nlcd_cville_blocks$imp_surf)

m <- leaflet()%>%
  addTiles()%>%
  addPolygons(data = cville_blkgps,
              fillColor = ~pal(imp_surf),
              weight = 0.75,
              opacity = 1,
              color = "white",
              fillOpacity = 0.6,
              highlight = highlightOptions(weight = 2, fillOpacity = 0.8, bringToFront = T),
              popup = paste0("FIPS Code: ", cville_blkgps$GEOID, "<br>",
                             "Percent Impervious Surface: ", cville_blkgps$imp_surf)) %>%
  addLegend("bottomright", pal = pal, values = cville_blkgps$imp_surf,
            title = "Average Percent Imperviuos Surface", opacity = 0.7)
m
```

### Blocks

Block level maps are slow to render and may be added later.


## Tree Canopy{.tabset}

The percent of space in each 30-meter cell covered by tree canopy is estimated. The measures below take the average percent of tree canopy across all of the cells within a spatial unit (census tract, census block group, census block).

### Tracts
```{r}
pal <- colorNumeric("plasma", reverse = TRUE, domain = nlcd_cville_blocks$tree_can)

m <- leaflet()%>%
  addTiles()%>%
  addPolygons(data = cville_tracts,
              fillColor = ~pal(tree_can),
              weight = 1,
              opacity = 1,
              color = "white",
              fillOpacity = 0.6,
              highlight = highlightOptions(weight = 2, fillOpacity = 0.8, bringToFront = T),
              popup = paste0("FIPS Code: ", cville_tracts$GEOID, "<br>",
                             "Percent Tree Canopy: ", cville_tracts$tree_can)) %>%
  addLegend("bottomright", pal = pal, values = cville_tracts$tree_can,
            title = "Average Percent Tree Canopy", opacity = 0.7)
m
```

### Block Groups
```{r}
pal <- colorNumeric("plasma", reverse = TRUE, domain = nlcd_cville_blocks$tree_can)

m <- leaflet()%>%
  addTiles()%>%
  addPolygons(data = cville_blkgps,
              fillColor = ~pal(tree_can),
              weight = 0.75,
              opacity = 1,
              color = "white",
              fillOpacity = 0.6,
              highlight = highlightOptions(weight = 2, fillOpacity = 0.8, bringToFront = T),
              popup = paste0("FIPS Code: ", cville_blkgps$GEOID, "<br>",
                             "Percent Tree Canopy: ", cville_blkgps$tree_can)) %>%
  addLegend("bottomright", pal = pal, values = cville_blkgps$tree_can,
            title = "Average Percent Tree Canopy", opacity = 0.7)
m
```

### Blocks

Block level maps are slow to render and may be added later.
