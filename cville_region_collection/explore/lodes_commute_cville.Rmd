---
title: "LEHD LODES"
subtitle: "Charlottesville Region 2018 Commuting Data"
author: "Lee LeBoeuf"
date: "09/06/2021"
output: 
  html_document: 
    toc: true
    toc_float: true
    code_folding: hide
---

```{r libraries, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)

invisible(lapply(list('tidyverse', 'stargazer', 'sf', 'leaflet', 'viridis', 'googlesheets4'),
                 function(pkg) library(pkg, character.only = TRUE)))

# main data
# tract
lodesresidents_tract <- read.csv("../data/lodes_residentcommute_cville_tract.csv")
lodesworkers_tract <- read.csv("../data/lodes_workercommute_cville_tract.csv")
lodesresidents_tract <- lodesresidents_tract %>% 
  mutate(GEOID = as.character(tract))
lodesworkers_tract <- lodesworkers_tract %>% 
  mutate(GEOID = as.character(tract))

# block group
lodesresidents_blkgp <- read.csv("../data/lodes_residentcommute_cville_blkgp.csv")
lodesworkers_blkgp <- read.csv("../data/lodes_workercommute_cville_blkgp.csv")
lodesresidents_blkgp <- lodesresidents_blkgp %>% 
  mutate(GEOID = as.character(blkgroup))
lodesworkers_blkgp <- lodesworkers_blkgp %>% 
  mutate(GEOID = as.character(blkgroup))

# block
lodesresidents_block <- read.csv("../data/lodes_residentcommute_cville_block.csv")
lodesworkers_block <- read.csv("../data/lodes_workercommute_cville_block.csv")
lodesresidents_block <- lodesresidents_block %>% 
  mutate(GEOID10 = as.character(h_geocode))
lodesworkers_block <- lodesworkers_block %>% 
  mutate(GEOID10 = as.character(w_geocode))

metaresidents <- read_sheet("https://docs.google.com/spreadsheets/d/1nqm3DuVXD1ObbVe_deacvT7uSLdBXfQJo3mkbqDwrVo/edit?usp=sharing", sheet = "lehd_lodes_rescommute", gs4_deauth())

metaworkers <- read_sheet("https://docs.google.com/spreadsheets/d/1nqm3DuVXD1ObbVe_deacvT7uSLdBXfQJo3mkbqDwrVo/edit?usp=sharing", sheet = "lehd_lodes_workcommute", gs4_deauth())

# spatial data
shape_tract <- readRDS('../data/cville_tracts.RDS')
shape_tract <- st_transform(shape_tract, crs = 4326) # to WGS84, given error

shape_blkgp <- readRDS('../data/cville_blkgps.RDS')
shape_blkgp <- st_transform(shape_blkgp, crs = 4326) # to WGS84, given error

shape_block <- readRDS('../data/cville_blocks.RDS')
shape_block <- st_transform(shape_block, crs = 4326) # to WGS84, given error
```

## Data source 
* Data structure description: https://lehd.ces.census.gov/data/lodes/LODES7/LODESTechDoc7.5.pdf
* Data download: https://lehd.ces.census.gov/data/lodes/LODES7/va/
* Helpful article about how these data are collected and how they can be used: https://www.researchgate.net/publication/328700665_The_US_Census_Longitudinal_Employer-Household_Dynamics_Datasets

## Data specifics
* The Longitudinal Employer Household Dynamics (LEHD) program at the US Census Bureau releases the Origin Destination Employment Statistis (LODES) datasets annually based on employer-employee insurance records. 
* This datafile uses data from the Origin-Destination (OD) data files from LEHD. The OD datafile lists each pair the census blocks for where workers live and work, enabling us to calculate the average commute distance by calculating the distance between each home and workplace census block pairing. 
* Distance calculations: All distances are "as the crow flies" and calulated using the Vincenty Ellipsoid method based on the latitude and longitudes of the centroids of each census block. These distances are then aggregated to the census block group and tract level. Distances are likely to be an underestimate of actual road travel. 
* Data presented here are from 2018 and spatial units are based on the 2010 census. As of July of 2021, 2018 is the most recent year for which data are available. The earliest year for which data are available is 2002. 
* There are two datafiles presented here:
    + Charlottesville region residents: The first contains average and median commute distances for each SU calculated based on the following groups: (1) People who live *and* work in the Charlottesville region; (2) Charlottesville area residents who work within 40 miles of their home census block; (3) Charlottesville area residents who work in a tract outside the Charlottesville area that employs at least 25 Charlottsville area residents; (4) All Charlottesville area residents represented in the LODES OD data. The data also contains the number of residents within each SU who fall into those 4 categories. 
    + Charlottesville region workers: The second contains average and median commute distnaces for each SU calculated based on the following groups:(1) Charlottesville area workers who live within 40 miles of their work-place census block; (2) Charlottesville area workers who live in a tract that (a) is outside the Charlottesville area and (b) is home to 25 or more Cville workers; and (3) All Charlottesville area workers represented in the data. This data file also contains the percent of workers in each SU that live outside the Charlottesville region. 
* Some limitations: 
    + The data are prone to imperfect geocoding for certain jobs; jobs for companies with multiple branches are often all coded in the same location. This means that distance calculations are likely to be an overestimate if many residents within one SU are employed by a company with multiple branches or a company whose headquarters is far away. There is also no way to differentiate between remote workers or the frequency with which any worker actually travels to their place of emplyoment (note: these data were collected prior to the COVID-19 pandemic when fewer people were working remotely). For these reasons, we include calculations of average and median commute distances based on multiple groups of workers. The estimates based on all residents in an SU are most likely to be an overestimate, while those based on residents working within 40 miles of home are likely to be the most conservative. 
    + The distances are "as the crow flies" and therefore imprecise estimates of actual commute distances on the road. 
    + These data do not include workers in defense-related industries. 
    + Student-workers are unlikely to be represented in these data because their jobs are not typically covered by state unemployment insurance. 


## Variable Descriptions {.tabset}

### Charlottesville Area Residents 
```{r}
glimpse(lodesresidents_blkgp)

metaresidents %>% 
  filter(su_blkgp == 1) %>%
  select(varname, about) %>% as.list()
```

### Charlottesville Area Workers
```{r}
glimpse(lodesworkers_blkgp)

metaworkers %>% 
  filter(su_blkgp == 1) %>%
  select(varname, about) %>% as.list()
```

## Variable Summaries {.tabset}

### Charlottesville Area Residents 
```{r}
lodesresidents_blkgp %>% select(avgc_allblk, avgc_within40blk, avgc_25_employeesblk, avgc_workinRegionblk, medc_allblk, medc_within40blk, medc_25_employeesblk, medc_workinRegionblk) %>% 
  select(where(~is.numeric(.x))) %>% 
  as.data.frame() %>% 
  stargazer(., type = "text", title = "Summary Statistics", digits = 1,
            summary.stat = c("mean", "sd", "min", "median", "max"))
```

### Charlottesville Area Workers
```{r}
lodesworkers_blkgp %>% select(avgc_allworkersblkgr, avgc_livewithin40blkgr, avgc_25_resblkgr, medc_allworkersblkgr, medc_livewithin40blkgr, medc_25_resblkgr, perc_workers_liveoutsideRegionblkgr) %>% 
  select(where(~is.numeric(.x))) %>% 
  as.data.frame() %>% 
  stargazer(., type = "text", title = "Summary Statistics", digits = 1,
            summary.stat = c("mean", "sd", "min", "median", "max"))
```

## Visual Distributions {.tabset}

### Charlottesville Area Residents {.tabset}

#### By Tracts
```{r}
longr <- lodesresidents_tract %>% select(c(tract, avgc_alltr, avgc_within40tr, avgc_25_employeestr, avgc_workinRegiontr, medc_alltr, medc_within40tr, medc_25_employeestr, medc_workinRegiontr)) %>% 
  pivot_longer(-tract, names_to = "measure", values_to = "value")

longr$measure <- factor(longr$measure,
                         levels = c("avgc_alltr", "medc_alltr", "avgc_within40tr", "medc_within40tr", "avgc_25_employeestr", "medc_25_employeestr", "avgc_workinRegiontr",
                                    "medc_workinRegiontr"))

longr %>% 
  ggplot(aes(x = value, fill = measure)) +
  scale_fill_viridis(option = "plasma", discrete = TRUE, guide = "none") +
  geom_histogram() + 
  facet_wrap(~measure, scales = "free", ncol = 2)
```

#### By Block Groups
```{r}
longr <- lodesresidents_blkgp %>% select(c(blkgroup, avgc_allblk, avgc_within40blk, avgc_25_employeesblk, avgc_workinRegionblk, medc_allblk, medc_within40blk, medc_25_employeesblk, medc_workinRegionblk)) %>% 
  pivot_longer(-blkgroup, names_to = "measure", values_to = "value")

longr$measure <- factor(longr$measure,
                         levels = c("avgc_allblk", "medc_allblk", "avgc_within40blk", "medc_within40blk", "avgc_25_employeesblk", "medc_25_employeesblk", "avgc_workinRegionblk",
                                    "medc_workinRegionblk"))

longr %>% 
  ggplot(aes(x = value, fill = measure)) +
  scale_fill_viridis(option = "plasma", discrete = TRUE, guide = "none") +
  geom_histogram() + 
  facet_wrap(~measure, scales = "free", ncol = 2)
```

#### By Blocks
```{r}
longr <- lodesresidents_block %>% select(c(h_geocode, avgc_all, avgc_within40, avgc_25_employees, avgc_workinRegion, medc_all, medc_within40, medc_25_employees, medc_workinRegion)) %>% 
  pivot_longer(-h_geocode, names_to = "measure", values_to = "value")

longr$measure <- factor(longr$measure,
                         levels = c("avgc_all", "medc_all", "avgc_within40", "medc_within40", "avgc_25_employees", "medc_25_employees", "avgc_workinRegion",
                                    "medc_workinRegion"))

longr %>% 
  ggplot(aes(x = value, fill = measure)) +
  scale_fill_viridis(option = "plasma", discrete = TRUE, guide = "none") +
  geom_histogram() + 
  facet_wrap(~measure, scales = "free", ncol = 2)
```


### Charlottesville Area Workers {.tabset}

#### By Tracts
```{r}
longw <- lodesworkers_tract %>% select(c(tract, avgc_allworkerstr, avgc_livewithin40tr, avgc_25_restr, medc_allworkerstr, medc_livewithin40tr, medc_25_restr)) %>% 
  pivot_longer(-tract, names_to = "measure", values_to = "value")

longw$measure <- factor(longw$measure,
                         levels = c("avgc_allworkerstr", "medc_allworkerstr", "avgc_livewithin40tr", "medc_livewithin40tr", "avgc_25_restr", "medc_25_restr"))

longw %>% 
  ggplot(aes(x = value, fill = measure)) +
  scale_fill_viridis(option = "plasma", discrete = TRUE, guide = "none") +
  geom_histogram() + 
  facet_wrap(~measure, scales = "free", ncol = 2)
```

#### By Block Groups
```{r}
longw <- lodesworkers_blkgp %>% select(c(blkgroup, avgc_allworkersblkgr, avgc_livewithin40blkgr, avgc_25_resblkgr, medc_allworkersblkgr, medc_livewithin40blkgr, medc_25_resblkgr)) %>% 
  pivot_longer(-blkgroup, names_to = "measure", values_to = "value")

longw$measure <- factor(longw$measure,
                         levels = c("avgc_allworkersblkgr", "medc_allworkersblkgr", "avgc_livewithin40blkgr", "medc_livewithin40blkgr", "avgc_25_resblkgr", "medc_25_resblkgr"))

longw %>% 
  ggplot(aes(x = value, fill = measure)) +
  scale_fill_viridis(option = "plasma", discrete = TRUE, guide = "none") +
  geom_histogram() + 
  facet_wrap(~measure, scales = "free", ncol = 2)
```

#### By Blocks
```{r}
longw <- lodesworkers_block %>% select(c(w_geocode, avgc_allworkers, avgc_livewithin40, avgc_25_res, medc_allworkers, medc_livewithin40, medc_25_res)) %>% 
  pivot_longer(-w_geocode, names_to = "measure", values_to = "value")

longw$measure <- factor(longw$measure,
                         levels = c("avgc_allworkers", "medc_allworkers", "avgc_livewithin40", "medc_livewithin40", "avgc_25_res", "medc_25_res"))

longw %>% 
  ggplot(aes(x = value, fill = measure)) +
  scale_fill_viridis(option = "plasma", discrete = TRUE, guide = "none") +
  geom_histogram() + 
  facet_wrap(~measure, scales = "free", ncol = 2)
```

## Mapping

```{r, echo = FALSE}
cvl_lodes_tract <- shape_tract %>% 
  left_join(lodesresidents_tract, by = "GEOID") %>% 
  left_join(lodesworkers_tract, by = "GEOID")

cvl_lodes_blkgp <- shape_blkgp %>% 
  left_join(lodesresidents_blkgp, by = "GEOID") %>% 
  left_join(lodesworkers_blkgp, by = "GEOID")

cvl_lodes_block <- shape_block %>% 
  left_join(lodesresidents_block, by = "GEOID10") %>% 
  left_join(lodesworkers_block, by = "GEOID10")
```

### All Cville area residents {.tabset}
Average commute distance.

#### By Tract
```{r}
pal <- colorNumeric("plasma", reverse = T, domain = cvl_lodes_tract$avgc_alltr)

leaflet(cvl_lodes_tract) %>% 
  addProviderTiles("CartoDB.Positron") %>% 
  addPolygons(data = cvl_lodes_tract,
              fillColor = ~pal(avgc_alltr),
              weight = 1,
              opacity = 1,
              color = "white", 
              fillOpacity = 0.6,
              highlight = highlightOptions(
                weight = 1, fillOpacity = 0.8, bringToFront = T
              ),
              popup = paste0("GEOID: ", cvl_lodes_tract$GEOID, "<br>",
                             "Average commute (mi): ", round(cvl_lodes_tract$avgc_alltr, 2))) %>% 
  addLegend("bottomright", pal = pal, values = cvl_lodes_tract$avgc_alltr, 
            title = "Average commute (mi)", opacity = 0.7)
```

#### By Block Group
```{r}
pal <- colorNumeric("plasma", reverse = T, domain = cvl_lodes_blkgp$avgc_allblk)

leaflet(cvl_lodes_blkgp) %>% 
  addProviderTiles("CartoDB.Positron") %>% 
  addPolygons(data = cvl_lodes_blkgp,
              fillColor = ~pal(avgc_allblk),
              weight = 1,
              opacity = 1,
              color = "white", 
              fillOpacity = 0.6,
              highlight = highlightOptions(
                weight = 1, fillOpacity = 0.8, bringToFront = T
              ),
              popup = paste0("GEOID: ", cvl_lodes_blkgp$GEOID, "<br>",
                             "Average commute (mi): ", round(cvl_lodes_blkgp$avgc_allblk, 2))) %>% 
  addLegend("bottomright", pal = pal, values = cvl_lodes_blkgp$avgc_allblk, 
            title = "Average commute (mi)", opacity = 0.7)
```

#### By Blocks

Block level maps are slow to render and may be added later.

### All Cville area workers {.tabset}
Average commmute distance.

#### By Tract
```{r}
pal <- colorNumeric("plasma", reverse = T, domain = 
                      cvl_lodes_tract$avgc_allworkertr)

leaflet(cvl_lodes_tract) %>% 
  addProviderTiles("CartoDB.Positron") %>% 
  addPolygons(data = cvl_lodes_tract,
              fillColor = ~pal(avgc_allworkerstr),
              weight = 1,
              opacity = 1,
              color = "white", 
              fillOpacity = 0.6,
              highlight = highlightOptions(
                weight = 1, fillOpacity = 0.8, bringToFront = T
              ),
              popup = paste0("GEOID: ", cvl_lodes_tract$GEOID, "<br>",
                             "Average commute (mi): ", round(cvl_lodes_tract$avgc_allworkerstr, 2))) %>% 
  addLegend("bottomright", pal = pal, values = cvl_lodes_tract$avgc_allworkerstr, 
            title = "Average commute (mi)", opacity = 0.7)
```

#### By Block Group
```{r}
pal <- colorNumeric("plasma", reverse = T, domain = 
                      cvl_lodes_blkgp$avgc_allworkersblkgr)

leaflet(cvl_lodes_blkgp) %>% 
  addProviderTiles("CartoDB.Positron") %>% 
  addPolygons(data = cvl_lodes_blkgp,
              fillColor = ~pal(avgc_allworkersblkgr),
              weight = 1,
              opacity = 1,
              color = "white", 
              fillOpacity = 0.6,
              highlight = highlightOptions(
                weight = 1, fillOpacity = 0.8, bringToFront = T
              ),
              popup = paste0("GEOID: ", cvl_lodes_blkgp$GEOID, "<br>",
                             "Average commute (mi): ", round(cvl_lodes_blkgp$avgc_allworkersblkgr, 2))) %>% 
  addLegend("bottomright", pal = pal, values = cvl_lodes_blkgp$avgc_allworkersblkgr, 
            title = "Average commute (mi)", opacity = 0.7)
```

#### By Blocks

Block level maps are slow to render and may be added later.


### Cville-Area Residents within 40 miles {.tabset}
Average commute among those who work with in 40 miles of home.

#### By Tract
```{r}
pal <- colorNumeric("plasma", reverse = T, domain = cvl_lodes_tract$avgc_within40tr)

leaflet(cvl_lodes_tract) %>% 
  addProviderTiles("CartoDB.Positron") %>% 
  addPolygons(data = cvl_lodes_tract,
              fillColor = ~pal(avgc_within40tr),
              weight = 1,
              opacity = 1,
              color = "white", 
              fillOpacity = 0.6,
              highlight = highlightOptions(
                weight = 1, fillOpacity = 0.8, bringToFront = T
              ),
              popup = paste0("GEOID: ", cvl_lodes_tract$GEOID, "<br>",
                             "Average commute (mi): ", round(cvl_lodes_tract$avgc_within40tr, 2))) %>% 
  addLegend("bottomright", pal = pal, values = cvl_lodes_tract$avgc_within40tr, 
            title = "Average commute (mi)", opacity = 0.7)
```

#### By Block Group
```{r}
pal <- colorNumeric("plasma", reverse = T, domain = cvl_lodes_blkgp$avgc_within40blk)

leaflet(cvl_lodes_blkgp) %>% 
  addProviderTiles("CartoDB.Positron") %>% 
  addPolygons(data = cvl_lodes_blkgp,
              fillColor = ~pal(avgc_within40blk),
              weight = 1,
              opacity = 1,
              color = "white", 
              fillOpacity = 0.6,
              highlight = highlightOptions(
                weight = 1, fillOpacity = 0.8, bringToFront = T
              ),
              popup = paste0("GEOID: ", cvl_lodes_blkgp$GEOID, "<br>",
                             "Average commute (mi): ", round(cvl_lodes_blkgp$avgc_within40blk, 2))) %>% 
  addLegend("bottomright", pal = pal, values = cvl_lodes_blkgp$avgc_within40blk, 
            title = "Average commute (mi)", opacity = 0.7)
```

#### By Blocks

Block level maps are slow to render and may be added later.


### Cville-Area Workers within 40 miles {.tabset}

#### By Tract
```{r}
pal <- colorNumeric("plasma", reverse = T, domain = cvl_lodes_tract$avgc_livewithin40tr)

leaflet(cvl_lodes_tract) %>% 
  addProviderTiles("CartoDB.Positron") %>% 
  addPolygons(data = cvl_lodes_tract,
              fillColor = ~pal(avgc_livewithin40tr),
              weight = 1,
              opacity = 1,
              color = "white", 
              fillOpacity = 0.6,
              highlight = highlightOptions(
                weight = 1, fillOpacity = 0.8, bringToFront = T
              ),
              popup = paste0("GEOID: ", cvl_lodes_tract$GEOID, "<br>",
                             "Average commute (mi): ", round(cvl_lodes_tract$avgc_livewithin40tr, 2))) %>% 
  addLegend("bottomright", pal = pal, values = cvl_lodes_tract$avgc_livewithin40tr, 
            title = "Average commute (mi)", opacity = 0.7)
```

#### By Block Group
```{r}
pal <- colorNumeric("plasma", reverse = T, domain = cvl_lodes_blkgp$avgc_livewithin40blkgr)

leaflet(cvl_lodes_blkgp) %>% 
  addProviderTiles("CartoDB.Positron") %>% 
  addPolygons(data = cvl_lodes_blkgp,
              fillColor = ~pal(avgc_livewithin40blkgr),
              weight = 1,
              opacity = 1,
              color = "white", 
              fillOpacity = 0.6,
              highlight = highlightOptions(
                weight = 1, fillOpacity = 0.8, bringToFront = T
              ),
              popup = paste0("GEOID: ", cvl_lodes_blkgp$GEOID, "<br>",
                             "Average commute (mi): ", round(cvl_lodes_blkgp$avgc_livewithin40blkgr, 2))) %>% 
  addLegend("bottomright", pal = pal, values = cvl_lodes_blkgp$avgc_livewithin40blkgr, 
            title = "Average commute (mi)", opacity = 0.7)
```

#### By Blocks

Block level maps are slow to render and may be added later.

### Cville-Area Workers and Residents {.tabset}

Average commute distances for people who work __and__ live in the Charlottesville region.

#### By Tract
```{r}
pal <- colorNumeric("plasma", reverse = T, domain = cvl_lodes_tract$avgc_workinRegiontr)

leaflet(cvl_lodes_tract) %>% 
  addProviderTiles("CartoDB.Positron") %>% 
  addPolygons(data = cvl_lodes_tract,
              fillColor = ~pal(avgc_workinRegiontr),
              weight = 1,
              opacity = 1,
              color = "white", 
              fillOpacity = 0.6,
              highlight = highlightOptions(
                weight = 1, fillOpacity = 0.8, bringToFront = T
              ),
              popup = paste0("GEOID: ", cvl_lodes_tract$GEOID, "<br>",
                             "Average commute (mi): ", round(cvl_lodes_tract$avgc_workinRegiontr, 2))) %>% 
  addLegend("bottomright", pal = pal, values = cvl_lodes_tract$avgc_workinRegiontr, 
            title = "Average commute (mi)", opacity = 0.7)
```

#### By Block Group
```{r}
pal <- colorNumeric("plasma", reverse = T, domain = cvl_lodes_blkgp$avgc_workinRegionblk)

leaflet(cvl_lodes_blkgp) %>% 
  addProviderTiles("CartoDB.Positron") %>% 
  addPolygons(data = cvl_lodes_blkgp,
              fillColor = ~pal(avgc_workinRegionblk),
              weight = 1,
              opacity = 1,
              color = "white", 
              fillOpacity = 0.6,
              highlight = highlightOptions(
                weight = 1, fillOpacity = 0.8, bringToFront = T
              ),
              popup = paste0("GEOID: ", cvl_lodes_blkgp$GEOID, "<br>",
                             "Average commute (mi): ", round(cvl_lodes_blkgp$avgc_workinRegionblk, 2))) %>% 
  addLegend("bottomright", pal = pal, values = cvl_lodes_blkgp$avgc_workinRegionblk, 
            title = "Average commute (mi)", opacity = 0.7)
```

#### By Blocks

Block level maps are slow to render and may be added later.

### Cville-Area Workers and Non-Residents {.tabset}

#### By Tract
```{r}
pal <- colorNumeric("plasma", reverse = T, domain = cvl_lodes_tract$perc_workers_liveoutsideRegiontr)

leaflet(cvl_lodes_tract) %>% 
  addProviderTiles("CartoDB.Positron") %>% 
  addPolygons(data = cvl_lodes_tract,
              fillColor = ~pal(perc_workers_liveoutsideRegiontr),
              weight = 1,
              opacity = 1,
              color = "white", 
              fillOpacity = 0.6,
              highlight = highlightOptions(
                weight = 1, fillOpacity = 0.8, bringToFront = T
              ),
              popup = paste0("GEOID: ", cvl_lodes_tract$GEOID, "<br>",
                             "Percent of workers: ", round(cvl_lodes_tract$perc_workers_liveoutsideRegiontr, 2))) %>% 
  addLegend("bottomright", pal = pal, values = cvl_lodes_tract$perc_workers_liveoutsideRegiontr, 
            title = "Percent of workers <br> who live outside Cville <br> region", opacity = 0.7)
```

#### By Block Group
```{r}
pal <- colorNumeric("plasma", reverse = T, domain = cvl_lodes_blkgp$perc_workers_liveoutsideRegionblkgr)

leaflet(cvl_lodes_blkgp) %>% 
  addProviderTiles("CartoDB.Positron") %>% 
  addPolygons(data = cvl_lodes_blkgp,
              fillColor = ~pal(perc_workers_liveoutsideRegionblkgr),
              weight = 1,
              opacity = 1,
              color = "white", 
              fillOpacity = 0.6,
              highlight = highlightOptions(
                weight = 1, fillOpacity = 0.8, bringToFront = T
              ),
              popup = paste0("GEOID: ", cvl_lodes_blkgp$GEOID, "<br>",
                             "Percent of workers: ", round(cvl_lodes_blkgp$perc_workers_liveoutsideRegionblkgr, 2))) %>% 
  addLegend("bottomright", pal = pal, values = cvl_lodes_blkgp$perc_workers_liveoutsideRegionblkgr, 
            title = "Percent of workers <br> who live outside Cville <br> region", opacity = 0.7)
```

#### By Blocks

Block level maps are slow to render and may be added later.

