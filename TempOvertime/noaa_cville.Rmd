---
title: "NOAA Temperature Data"
subtitle: "Data for Charlottesville Region"
author: "Tolu Odukoya"
date: "7/6/2021"
output: 
  html_document: 
    toc: true
    toc_float: true
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
# 0. Load libraries and data
library(tidyverse)
library(stargazer) # for summary table
library(janitor) # for tabyl
library(tigris) # for shapefiles
library(sf) # for spatial joins
library(leaflet) # for map
library(viridis)
library(googlesheets4)
library(RColorBrewer)
library(ggplot2)
library(gganimate)
library(gapminder)
library(transformr)
library(gifski)
library(ggrepel)
library(hrbrthemes)
library(devtools)
library(climatestripes)
library(lubridate)
noaa <- read_csv("noaa_cville_county.csv")
cvillefips <- c("540", "003", "065", "079", "109", "125")
meta <- read_sheet("https://docs.google.com/spreadsheets/d/1nqm3DuVXD1ObbVe_deacvT7uSLdBXfQJo3mkbqDwrVo/edit#gid=1573436636", sheet = "noaa")
```

```{r load and clean new data shp, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)

cville_sf <- read_sf("/Users/msbugatti/Documents/Intership 2021/NOAA Temp Work/counties")
cville_sf <- cville_sf %>% filter(FIPS %in% c(51540, 51003, 51065, 51079, 51109, 51125))
cville_sf <- cville_sf %>%
                      dplyr::select(NAME, STATE_FIPS, CNTY_FIPS, FIPS, geometry, AREA)
cville_sf1 <- left_join(cville_sf, noaa, by ="CNTY_FIPS")
```


```{r transpose the data, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)

cville_sf1 <- st_as_sf(cville_sf1)
cville_sf1 <- cbind(cville_sf1, st_coordinates(st_centroid(cville_sf1)))
```

```{r remove na, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)

cville_sf1 <- cville_sf1 %>%
                      dplyr::select(NAME, Year, CNTY_FIPS, X, Y,
                                geometry, everything())
cville_sf1$Year = as.numeric(cville_sf1$Year)
cville_sf1 <-  cville_sf1 %>% filter_at(vars(Janmin:Avg_Temppcp),all_vars(!is.na(.)))
```

## Data Source

Source: NOAA's Climate Divisional Database (nClimDiv), June 2021 release

* Download URL: [https://www.ncei.noaa.gov/pub/data/cirs/climdiv/counties.zip](https://www.ncei.noaa.gov/pub/data/cirs/climdiv/counties.zip)
* Download URL: [https://www.ncei.noaa.gov/pub/data/cirs/climdiv/climdiv-tmaxcy-v1.0.0-20210604](https://www.ncei.noaa.gov/pub/data/cirs/climdiv/climdiv-tmaxcy-v1.0.0-20210604)

### The Data Used Here

The Climate Divisional Dataset from the National Center For Environmental Information began as the only long-term temporally and spatially complete dataset from which to generate historical climate analyses (1895-2013) for the contiguous United States (CONUS). It was originally developed for climate division, statewide, regional, national, and population-weighted monitoring of drought, temperature, precipitation, and heating/cooling degree day values. 

There are 344 climate divisions in the CONUS. For each climate division, monthly station temperature and precipitation values are computed from the daily observations. The divisional values are weighted by area to compute statewide values and the statewide values are weighted by area to compute regional values. (Karl and Koss, 1984).

The data here is the county data from all the states in the contigous United States. While NOAA includes information on a variety of climate measures, we are focusing on the maximum, minimum temperature, and precipitation of the counties of interest. 

To Learn More, See: 

* [ National Center For Environmental Information and Data ](https://www.ncdc.noaa.gov/monitoring-references/maps/us-climate-divisions.php#grdd)


## Variable Descriptions

```{r}
glimpse(cville_sf1)
```

Observations are county level estimates of...

* Monthly maximum temperature for each county for years 1895-2021
    * Yearly average maximum temperature for each county for those years. 


* Monthly minimum temperature for each county for years 1895-2021
    * Yearly average minimum temperature for each county for those years. 


* Monthly precipitation for each county for years 1895-2021
    * Yearly average precipitation for each county for those years.


## Summaries 

5-number summaries of (non-missing) numeric variables (remove non-numeric observations)

```{r}
noaa %>% select(-c(CNTY_FIPS, Fipsyear, Year)) %>% 
  select(where(~is.numeric(.x) && !is.na(.x))) %>% 
  as.data.frame() %>% 
  stargazer(., type = "text", title = "Summary Statistics", digits = 0,
            summary.stat = c("mean", "sd", "min", "median", "max"))
```


## Maps

### Maximum Temperature 

#### Maximum Temperature in July across Counties for all Years 

```{r}
cville_sf1a <- 
  ggplot(cville_sf1) +
  geom_sf(aes(fill = Julmax), color = "black", alpha = .9, na.rm = TRUE) +
   geom_text_repel(data = cville_sf1, aes(X, Y, label = NAME), size = 4, nudge_x = 1, nudge_y = 0, fontface = "bold", hjust = 0.9) +
  scale_fill_fermenter(palette = "YlOrRd", direction = 1,   type = "seq", n.breaks = 7) +
     theme_void() +
  guides(fill =
           guide_colourbar(title.position="top", title.hjust = 0.5,
                           barwidth = 1)
  )  + 
  labs(fill = "Temperature ", title = 'Year: {frame_time}',
       caption = "Maximum Temperature in July for Charlottesville Counties") + 
 transition_time(as.integer(Year)) +
ease_aes('linear') 
```

```{r}
animate(cville_sf1a, fps = 1, detail = 1, nframes = 127)
```

```{r, results = "asis"}
meta %>%
  filter(varname == "Julmax") %>% 
  select(about) %>% 
  as.list()
```

#### Warming Stripes Showing Maximum Temperature in July for Each County for all Years 
```{r warming1,  echo = TRUE, warning = FALSE, message = FALSE}

#select only the july temperature and year column
cville_sf1_jl <- select(cville_sf1, NAME, Year, Julmax)

#rename the temperature column
cville_sf1_jl <- rename(cville_sf1_jl, ta = Julmax)

```

```{r warming2, echo = TRUE, warning = FALSE, message = FALSE}

#create a date column because stripes only works with format = date
cville_sf1_jl <- mutate(cville_sf1_jl, date = str_c(Year, "01-01", sep = "-") %>% ymd())

```

```{r  warming3, echo = TRUE, warning = FALSE, message = FALSE}

# Filter out each County 

cville_sf1_jlg <- filter(cville_sf1_jl, NAME == "Greene")
cville_sf1_jla <- filter(cville_sf1_jl, NAME == "Albemarle")
cville_sf1_jlc <- filter(cville_sf1_jl, NAME == "Charlottesville")
cville_sf1_jlf <- filter(cville_sf1_jl, NAME == "Fluvanna")
cville_sf1_jll <- filter(cville_sf1_jl, NAME == "Louisa")
cville_sf1_jln <- filter(cville_sf1_jl, NAME == "Nelson")
```

```{r  warming4, echo = TRUE, warning = FALSE, message = FALSE}

#Create the theme for the stripes image

theme_strip <- theme_minimal()+
                 theme(axis.text.y = element_blank(),
                       axis.line.y = element_blank(),
                       axis.title = element_blank(),
                       panel.grid.major = element_blank(),
                       legend.title = element_blank(),
                       axis.text.x = element_text(vjust = 3),
                       panel.grid.minor = element_blank(),
                        plot.title = element_text(size = 14, face = "bold")
                       )


col_strip <- brewer.pal(11, "RdBu")
```

##### Greene County  Warming Stripes: July Maximum Temperature
```{r stripes1,fig.width=10, fig.height=3, message=FALSE, warning=FALSE}
 ggplot(cville_sf1_jlg,
             aes(x = date, y = 1, fill = ta))+
        geom_tile()+
           scale_x_date(date_breaks = "6 years",
                     date_labels = "%Y",
                     expand = c(0, 0))+
           scale_y_continuous(expand = c(0, 0))+
           scale_fill_gradientn(colors = rev(col_strip))+
             guides(fill = guide_colorbar(barwidth = 1))+
            labs(title = "Greene County July Maximum Temperature 1895-2020",
                caption = "Data: NOAA Surface Temperature Analysis")+
              theme_strip
```

##### Louisa County Warming Stripes: July Maximum Temperature
```{r stripes2,fig.width=10, fig.height=3, message=FALSE, warning=FALSE}
 ggplot(cville_sf1_jll,
             aes(x = date, y = 1, fill = ta))+
        geom_tile()+
           scale_x_date(date_breaks = "6 years",
                     date_labels = "%Y",
                     expand = c(0, 0))+
           scale_y_continuous(expand = c(0, 0))+
           scale_fill_gradientn(colors = rev(col_strip))+
             guides(fill = guide_colorbar(barwidth = 1))+
            labs(title = "Louisa County July Maximum Temperature 1895-2020",
                caption = "Data: NOAA Surface Temperature Analysis")+
              theme_strip
```

##### Nelson County Warming Stripes: July Maximum Temperature
```{r stripes3,fig.width=10, fig.height=3, message=FALSE, warning=FALSE}
 ggplot(cville_sf1_jln,
             aes(x = date, y = 1, fill = ta))+
        geom_tile()+
           scale_x_date(date_breaks = "6 years",
                     date_labels = "%Y",
                     expand = c(0, 0))+
           scale_y_continuous(expand = c(0, 0))+
           scale_fill_gradientn(colors = rev(col_strip))+
             guides(fill = guide_colorbar(barwidth = 1))+
            labs(title = "Nelson County July Maximum Temperature 1895-2020",
                caption = "Data: NOAA Surface Temperature Analysis")+
              theme_strip
```

##### Albemarle County Warming Stripes: July Maximum Temperature
```{r stripes4,fig.width=10, fig.height=3, message=FALSE, warning=FALSE}
 ggplot(cville_sf1_jla,
             aes(x = date, y = 1, fill = ta))+
        geom_tile()+
           scale_x_date(date_breaks = "6 years",
                     date_labels = "%Y",
                     expand = c(0, 0))+
           scale_y_continuous(expand = c(0, 0))+
           scale_fill_gradientn(colors = rev(col_strip))+
             guides(fill = guide_colorbar(barwidth = 1))+
            labs(title = "Albemarle County July Maximum Temperature 1895-2020",
                caption = "Data: NOAA Surface Temperature Analysis")+
              theme_strip
```

##### Charlottesville County Warming Stripes: July Maximum Temperature
```{r stripes5,fig.width=10, fig.height=3, message=FALSE, warning=FALSE}
 ggplot(cville_sf1_jlc,
             aes(x = date, y = 1, fill = ta))+
        geom_tile()+
           scale_x_date(date_breaks = "6 years",
                     date_labels = "%Y",
                     expand = c(0, 0))+
           scale_y_continuous(expand = c(0, 0))+
           scale_fill_gradientn(colors = rev(col_strip))+
             guides(fill = guide_colorbar(barwidth = 1))+
            labs(title = "Charlottesville County July Maximum Temperature 1895-2020",
                caption = "Data: NOAA Surface Temperature Analysis")+
              theme_strip
```

##### Fluvanna County Warming Stripes: July Maximum Temperature
```{r stripes6,fig.width=10, fig.height=3, message=FALSE, warning=FALSE}
 ggplot(cville_sf1_jlf,
             aes(x = date, y = 1, fill = ta))+
        geom_tile()+
           scale_x_date(date_breaks = "6 years",
                     date_labels = "%Y",
                     expand = c(0, 0))+
           scale_y_continuous(expand = c(0, 0))+
           scale_fill_gradientn(colors = rev(col_strip))+
             guides(fill = guide_colorbar(barwidth = 1))+
            labs(title = "Fluvanna County July Maximum Temperature 1895-2020",
                caption = "Data: NOAA Surface Temperature Analysis")+
              theme_strip
```


#### Average Yearly Maximum Temperature across Counties

```{r}
cville_sf1b <- 
  ggplot(cville_sf1) +
  geom_sf(aes(fill = Avg_Tempmax), color = "black", alpha = .9, na.rm = TRUE) +
   geom_text_repel(data = cville_sf1, aes(X, Y, label = NAME), size = 4, nudge_x = 1, nudge_y = 0, fontface = "bold", hjust = 0.9) +
  scale_fill_fermenter(palette = "BuPu", direction = 1,   type = "seq", n.breaks = 6) +
     theme_void() +
  guides(fill =
           guide_colourbar(title.position="top", title.hjust = 0.5,
                           barwidth = 1)
  )  + 
  labs(fill = "Temperature ", title = 'Year: {frame_time}',
       caption = "Average Yearly Maximum 
       Temperature For Charlottesville Counties") + 
 transition_time(as.integer(Year)) +
ease_aes('linear') 
```

```{r}
animate(cville_sf1b, fps = 1, detail = 1, nframes = 127)
```


```{r, results = "asis"}
meta %>%
  filter(varname == "Avg_Tempmax") %>% 
  select(about) %>% 
  as.list()
```

#### Warming Stripes Showing Average Yearly Temperature for Each County
```{r  warming6, echo = TRUE, warning = FALSE, message = FALSE}

#select only the annual temperature and year column
cville_sf1_yr <- select(cville_sf1, NAME, Year, Avg_Tempmax)

#rename the temperature column
cville_sf1_yr <- rename(cville_sf1_yr, ta = Avg_Tempmax)

```

```{r  warming7, echo = TRUE, warning = FALSE, message = FALSE}
#create a date column because stripes only works with format = date

cville_sf1_yr <- mutate(cville_sf1_yr, date = str_c(Year, "01-01", sep = "-") %>% ymd())

```

```{r warming8, echo = TRUE, warning = FALSE, message = FALSE}

#Filter out each County. No need to do theme again it's already set 
cville_sf1_yrg <- filter(cville_sf1_yr, NAME == "Greene")
cville_sf1_yra <- filter(cville_sf1_yr, NAME == "Albemarle")
cville_sf1_yrc <- filter(cville_sf1_yr, NAME == "Charlottesville")
cville_sf1_yrf <- filter(cville_sf1_yr, NAME == "Fluvanna")
cville_sf1_yrl <- filter(cville_sf1_yr, NAME == "Louisa")
cville_sf1_yrn <- filter(cville_sf1_yr, NAME == "Nelson")
```

##### Greene County Warming Stripes: Average Yearly Maximum Temperature
```{r stripes1ad,fig.width=10, fig.height=3,  message=FALSE, warning=FALSE}
 ggplot(cville_sf1_yrg,
             aes(x = date, y = 1, fill = ta))+
        geom_tile()+
           scale_x_date(date_breaks = "6 years",
                     date_labels = "%Y",
                     expand = c(0, 0))+
           scale_y_continuous(expand = c(0, 0))+
           scale_fill_gradientn(colors = rev(col_strip))+
             guides(fill = guide_colorbar(barwidth = 1))+
            labs(title = "Greene County Average Yearly Maximum Temperature 1895-2020",
                caption = "Data: NOAA Surface Temperature Analysis")+
              theme_strip
```

##### Louisa County Warming Stripes: Average Yearly Maximum Temperature
```{r stripes2ad,fig.width=10, fig.height=3, message=FALSE, warning=FALSE}
 ggplot(cville_sf1_yrl,
             aes(x = date, y = 1, fill = ta))+
        geom_tile()+
           scale_x_date(date_breaks = "6 years",
                     date_labels = "%Y",
                     expand = c(0, 0))+
           scale_y_continuous(expand = c(0, 0))+
           scale_fill_gradientn(colors = rev(col_strip))+
             guides(fill = guide_colorbar(barwidth = 1))+
            labs(title = "Louisa County Average Yearly Maximum Temperature 1895-2020",
                caption = "Data: NOAA Surface Temperature Analysis")+
              theme_strip
```

##### Nelson County Warming Stripes: Average Yearly Maximum Temperature
```{r stripes3ad,fig.width=10, fig.height=3, message=FALSE, warning=FALSE}
 ggplot(cville_sf1_yrn,
             aes(x = date, y = 1, fill = ta))+
        geom_tile()+
           scale_x_date(date_breaks = "6 years",
                     date_labels = "%Y",
                     expand = c(0, 0))+
           scale_y_continuous(expand = c(0, 0))+
           scale_fill_gradientn(colors = rev(col_strip))+
             guides(fill = guide_colorbar(barwidth = 1))+
            labs(title = "Nelson County Average Yearly Maximum Temperature 1895-2020",
                caption = "Data: NOAA Surface Temperature Analysis")+
              theme_strip
```

##### Albemarle County Warming Stripes: Average Yearly Maximum Temperature
```{r stripes4ad,fig.width=10, fig.height=3,  message=FALSE, warning=FALSE}
 ggplot(cville_sf1_yra,
             aes(x = date, y = 1, fill = ta))+
        geom_tile()+
           scale_x_date(date_breaks = "6 years",
                     date_labels = "%Y",
                     expand = c(0, 0))+
           scale_y_continuous(expand = c(0, 0))+
           scale_fill_gradientn(colors = rev(col_strip))+
             guides(fill = guide_colorbar(barwidth = 1))+
            labs(title = "Albemarle County Average Yearly Maximum Temperature 1895-2020",
                caption = "Data: NOAA Surface Temperature Analysis")+
              theme_strip
```

##### Charlottesville County Warming Stripes: Average Yearly Maximum Temperature
```{r stripes5ad,fig.width=10, fig.height=3, message=FALSE, warning=FALSE}
 ggplot(cville_sf1_yrc,
             aes(x = date, y = 1, fill = ta))+
        geom_tile()+
           scale_x_date(date_breaks = "6 years",
                     date_labels = "%Y",
                     expand = c(0, 0))+
           scale_y_continuous(expand = c(0, 0))+
           scale_fill_gradientn(colors = rev(col_strip))+
             guides(fill = guide_colorbar(barwidth = 1))+
            labs(title = "Charlottesville County Average Yearly Maximum Temperature 1895-2020",
                caption = "Data: NOAA Surface Temperature Analysis")+
              theme_strip
```

##### Fluvanna County Warming Stripes: Average Yearly Maximum Temperature
```{r stripes6ad,fig.width=10, fig.height=3, message=FALSE, warning=FALSE}
 ggplot(cville_sf1_yrf,
             aes(x = date, y = 1, fill = ta))+
        geom_tile()+
           scale_x_date(date_breaks = "6 years",
                     date_labels = "%Y",
                     expand = c(0, 0))+
           scale_y_continuous(expand = c(0, 0))+
           scale_fill_gradientn(colors = rev(col_strip))+
             guides(fill = guide_colorbar(barwidth = 1))+
            labs(title = "Fluvanna County Average Yearly Maximum Temperature 1895-2020",
                caption = "Data: NOAA Surface Temperature Analysis")+
              theme_strip
```


### Minimum Temperature

#### Minimum Temperature in July across Counties for all Years 

```{r}
cville_sf2a <- 
  ggplot(cville_sf1) +
  geom_sf(aes(fill = Julmin), color = "black", alpha = .9, na.rm = TRUE) +
   geom_text_repel(data = cville_sf1, aes(X, Y, label = NAME), size = 4, nudge_x = 1, nudge_y = 0, fontface = "bold", hjust = 0.9) +
  scale_fill_fermenter(palette = "YlGnBu", direction = 1,   type = "seq", n.breaks = 7) +
     theme_void() +
  guides(fill =
           guide_colourbar(title.position="top", title.hjust = 0.5,
                           barwidth = 1)
  )  + 
  labs(fill = "Temperature ", title = 'Year: {frame_time}',
       caption = "Minimum Temperature in July for Charlottesville Counties") + 
 transition_time(as.integer(Year)) +
ease_aes('linear') 
```

```{r}
animate(cville_sf2a, fps = 1, detail = 1, nframes = 127)
```

```{r, results = "asis"}
meta %>%
  filter(varname == "Julmin") %>% 
  select(about) %>% 
  as.list()
```

#### Warming Stripes Showing Minimum Temperature in July for Each County for all Years 
```{r warming1a, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)

#select only the july temperature and year column
cville_sf2_jl <- select(cville_sf1, NAME, Year, Julmin)

#rename the temperature column
cville_sf2_jl <- rename(cville_sf2_jl, ta = Julmin)

```

```{r warming2ad, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)

#create a date column because stripes only works with format = date
cville_sf2_jl <- mutate(cville_sf2_jl, date = str_c(Year, "01-01", sep = "-") %>% ymd())

```

```{r  warming3ad, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)

cville_sf2_jlg <- filter(cville_sf2_jl, NAME == "Greene")
cville_sf2_jla <- filter(cville_sf2_jl, NAME == "Albemarle")
cville_sf2_jlc <- filter(cville_sf2_jl, NAME == "Charlottesville")
cville_sf2_jlf <- filter(cville_sf2_jl, NAME == "Fluvanna")
cville_sf2_jll <- filter(cville_sf2_jl, NAME == "Louisa")
cville_sf2_jln <- filter(cville_sf2_jl, NAME == "Nelson")
```


##### Greene County Warming Stripes: July Minimum Temperature
```{r stripes1a,fig.width=10, fig.height=3, message=FALSE, warning=FALSE}
 ggplot(cville_sf2_jlg,
             aes(x = date, y = 1, fill = ta))+
        geom_tile()+
           scale_x_date(date_breaks = "6 years",
                     date_labels = "%Y",
                     expand = c(0, 0))+
           scale_y_continuous(expand = c(0, 0))+
           scale_fill_gradientn(colors = rev(col_strip))+
             guides(fill = guide_colorbar(barwidth = 1))+
            labs(title = "Greene County July Minimum Temperature 1895-2020",
                caption = "Data: NOAA Surface Temperature Analysis")+
              theme_strip
```

##### Louisa County Warming Stripes: July Minimum Temperature
```{r stripes2q,fig.width=10, fig.height=3, message=FALSE, warning=FALSE}
 ggplot(cville_sf2_jll,
             aes(x = date, y = 1, fill = ta))+
        geom_tile()+
           scale_x_date(date_breaks = "6 years",
                     date_labels = "%Y",
                     expand = c(0, 0))+
           scale_y_continuous(expand = c(0, 0))+
           scale_fill_gradientn(colors = rev(col_strip))+
             guides(fill = guide_colorbar(barwidth = 1))+
            labs(title = "Louisa County July Minimum Temperature 1895-2020",
                caption = "Data: NOAA Surface Temperature Analysis")+
              theme_strip
```

##### Nelson County Warming Stripes: July Minimum Temperature
```{r stripes3a,fig.width=10, fig.height=3, message=FALSE, warning=FALSE}
 ggplot(cville_sf2_jln,
             aes(x = date, y = 1, fill = ta))+
        geom_tile()+
           scale_x_date(date_breaks = "6 years",
                     date_labels = "%Y",
                     expand = c(0, 0))+
           scale_y_continuous(expand = c(0, 0))+
           scale_fill_gradientn(colors = rev(col_strip))+
             guides(fill = guide_colorbar(barwidth = 1))+
            labs(title = "Nelson County July Minimum Temperature 1895-2020",
                caption = "Data: NOAA Surface Temperature Analysis")+
              theme_strip
```

##### Albemarle County Warming Stripes: July Minimum Temperature
```{r stripes4a,fig.width=10, fig.height=3, message=FALSE, warning=FALSE}
 ggplot(cville_sf2_jla,
             aes(x = date, y = 1, fill = ta))+
        geom_tile()+
           scale_x_date(date_breaks = "6 years",
                     date_labels = "%Y",
                     expand = c(0, 0))+
           scale_y_continuous(expand = c(0, 0))+
           scale_fill_gradientn(colors = rev(col_strip))+
             guides(fill = guide_colorbar(barwidth = 1))+
            labs(title = "Albemarle County July Minimum Temperature 1895-2020",
                caption = "Data: NOAA Surface Temperature Analysis")+
              theme_strip
```

##### Charlottesville County Warming Stripes: July Minimum Temperature
```{r stripes5a,fig.width=10, fig.height=3, message=FALSE, warning=FALSE}
 ggplot(cville_sf2_jlc,
             aes(x = date, y = 1, fill = ta))+
        geom_tile()+
           scale_x_date(date_breaks = "6 years",
                     date_labels = "%Y",
                     expand = c(0, 0))+
           scale_y_continuous(expand = c(0, 0))+
           scale_fill_gradientn(colors = rev(col_strip))+
             guides(fill = guide_colorbar(barwidth = 1))+
            labs(title = "Charlottesville County July Minimum Temperature 1895-2020",
                caption = "Data: NOAA Surface Temperature Analysis")+
              theme_strip
```

##### Fluvanna County Warming Stripes: July Minimum Temperature
```{r stripes6a,fig.width=10, fig.height=3, message=FALSE, warning=FALSE}
 ggplot(cville_sf2_jlf,
             aes(x = date, y = 1, fill = ta))+
        geom_tile()+
           scale_x_date(date_breaks = "6 years",
                     date_labels = "%Y",
                     expand = c(0, 0))+
           scale_y_continuous(expand = c(0, 0))+
           scale_fill_gradientn(colors = rev(col_strip))+
             guides(fill = guide_colorbar(barwidth = 1))+
            labs(title = "Fluvanna County July Minimum Temperature 1895-2020",
                caption = "Data: NOAA Surface Temperature Analysis")+
              theme_strip
```


#### Average Yearly Minimum Temperature across Counties

```{r}
cville_sf2b <- 
  ggplot(cville_sf1) +
  geom_sf(aes(fill = Avg_Tempmin), color = "black", alpha = .9, na.rm = TRUE) +
   geom_text_repel(data = cville_sf1, aes(X, Y, label = NAME), size = 4, nudge_x = 1, nudge_y = 0, fontface = "bold", hjust = 0.9) +
  scale_fill_fermenter(palette = "PuRd", direction = 1,   type = "seq", n.breaks = 6) +
     theme_void() +
  guides(fill =
           guide_colourbar(title.position="top", title.hjust = 0.5,
                           barwidth = 1)
  )  + 
  labs(fill = "Temperature ", title = 'Year: {frame_time}',
       caption = "Average Yearly Minimum 
       Temperature For Charlottesville Counties") + 
 transition_time(as.integer(Year)) +
ease_aes('linear') 
```

```{r}
animate(cville_sf2b, fps = 1, detail = 1, nframes = 127)
```


```{r, results = "asis"}
meta %>%
  filter(varname == "Avg_Tempmin") %>% 
  select(about) %>% 
  as.list()
```

#### Warming Stripes Showing Average Yearly Temperature for Each County
```{r  warming6a, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)

#select only the annual temperature and year column
cville_sf2_yr <- select(cville_sf1, NAME, Year, Avg_Tempmin)

#rename the temperature column
cville_sf2_yr <- rename(cville_sf2_yr, ta = Avg_Tempmin)

```

```{r  warming7a, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)

#create a date column because stripes only works with format = date

cville_sf2_yr <- mutate(cville_sf2_yr, date = str_c(Year, "01-01", sep = "-") %>% ymd())

```

```{r warming8a, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)

cville_sf2_yrg <- filter(cville_sf2_yr, NAME == "Greene")
cville_sf2_yra <- filter(cville_sf2_yr, NAME == "Albemarle")
cville_sf2_yrc <- filter(cville_sf2_yr, NAME == "Charlottesville")
cville_sf2_yrf <- filter(cville_sf2_yr, NAME == "Fluvanna")
cville_sf2_yrl <- filter(cville_sf2_yr, NAME == "Louisa")
cville_sf2_yrn <- filter(cville_sf2_yr, NAME == "Nelson")
```

##### Greene County Warming Stripes: Average Yearly Minimum Temperature
```{r stripes1ab,fig.width=10, fig.height=3,  message=FALSE, warning=FALSE}
 ggplot(cville_sf2_yrg,
             aes(x = date, y = 1, fill = ta))+
        geom_tile()+
           scale_x_date(date_breaks = "6 years",
                     date_labels = "%Y",
                     expand = c(0, 0))+
           scale_y_continuous(expand = c(0, 0))+
           scale_fill_gradientn(colors = rev(col_strip))+
             guides(fill = guide_colorbar(barwidth = 1))+
            labs(title = "Greene County Average Yearly Minimum Temperature 1895-2020",
                caption = "Data: NOAA Surface Temperature Analysis")+
              theme_strip
```

##### Louisa County Warming Stripes: Average Yearly Minimum Temperature
```{r stripes2ab,fig.width=10, fig.height=3, message=FALSE, warning=FALSE}
 ggplot(cville_sf2_yrl,
             aes(x = date, y = 1, fill = ta))+
        geom_tile()+
           scale_x_date(date_breaks = "6 years",
                     date_labels = "%Y",
                     expand = c(0, 0))+
           scale_y_continuous(expand = c(0, 0))+
           scale_fill_gradientn(colors = rev(col_strip))+
             guides(fill = guide_colorbar(barwidth = 1))+
            labs(title = "Louisa County Average Yearly Minimum Temperature 1895-2020",
                caption = "Data: NOAA Surface Temperature Analysis")+
              theme_strip
```

##### Nelson County Warming Stripes: Average Yearly Minimum Temperature
```{r stripes3ab,fig.width=10, fig.height=3, message=FALSE, warning=FALSE}
 ggplot(cville_sf2_yrn,
             aes(x = date, y = 1, fill = ta))+
        geom_tile()+
           scale_x_date(date_breaks = "6 years",
                     date_labels = "%Y",
                     expand = c(0, 0))+
           scale_y_continuous(expand = c(0, 0))+
           scale_fill_gradientn(colors = rev(col_strip))+
             guides(fill = guide_colorbar(barwidth = 1))+
            labs(title = "Nelson County Average Yearly Minimum Temperature 1895-2020",
                caption = "Data: NOAA Surface Temperature Analysis")+
              theme_strip
```

##### Albemarle County Warming Stripes: Average Yearly Minimum Temperature
```{r stripes4ab,fig.width=10, fig.height=3,  message=FALSE, warning=FALSE}
 ggplot(cville_sf2_yra,
             aes(x = date, y = 1, fill = ta))+
        geom_tile()+
           scale_x_date(date_breaks = "6 years",
                     date_labels = "%Y",
                     expand = c(0, 0))+
           scale_y_continuous(expand = c(0, 0))+
           scale_fill_gradientn(colors = rev(col_strip))+
             guides(fill = guide_colorbar(barwidth = 1))+
            labs(title = "Albemarle County Average Yearly Minimum Temperature 1895-2020",
                caption = "Data: NOAA Surface Temperature Analysis")+
              theme_strip
```

##### Charlottesville County Warming Stripes: Average Yearly Minimum Temperature
```{r stripes5ab,fig.width=10, fig.height=3, message=FALSE, warning=FALSE}
 ggplot(cville_sf2_yrc,
             aes(x = date, y = 1, fill = ta))+
        geom_tile()+
           scale_x_date(date_breaks = "6 years",
                     date_labels = "%Y",
                     expand = c(0, 0))+
           scale_y_continuous(expand = c(0, 0))+
           scale_fill_gradientn(colors = rev(col_strip))+
             guides(fill = guide_colorbar(barwidth = 1))+
            labs(title = "Charlottesville County Average Yearly Minimum Temperature 1895-2020",
                caption = "Data: NOAA Surface Temperature Analysis")+
              theme_strip
```

##### Fluvanna County Warming Stripes: Average Yearly Minimum Temperature
```{r stripes6ab,fig.width=10, fig.height=3, message=FALSE, warning=FALSE}
 ggplot(cville_sf2_yrf,
             aes(x = date, y = 1, fill = ta))+
        geom_tile()+
           scale_x_date(date_breaks = "6 years",
                     date_labels = "%Y",
                     expand = c(0, 0))+
           scale_y_continuous(expand = c(0, 0))+
           scale_fill_gradientn(colors = rev(col_strip))+
             guides(fill = guide_colorbar(barwidth = 1))+
            labs(title = "Fluvanna County Average Yearly Minimum Temperature 1895-2020",
                caption = "Data: NOAA Surface Temperature Analysis")+
              theme_strip
```


### Precipitation

#### Precipitation in July across Counties for all Years 

```{r}
cville_sf3a <- 
  ggplot(cville_sf1) +
  geom_sf(aes(fill = Julpcp), color = "black", alpha = .9, na.rm = TRUE) +
   geom_text_repel(data = cville_sf1, aes(X, Y, label = NAME), size = 4, nudge_x = 1, nudge_y = 0, fontface = "bold", hjust = 0.9) +
  scale_fill_fermenter(palette = "PuBuGn", direction = 1,   type = "seq", n.breaks = 7) +
     theme_void() +
  guides(fill =
           guide_colourbar(title.position="top", title.hjust = 0.5,
                           barwidth = 1)
  )  + 
  labs(fill = "Precipitation", title = 'Year: {frame_time}',
       caption = "Precipitation in July for Charlottesville Counties") + 
 transition_time(as.integer(Year)) +
ease_aes('linear') 
```

```{r}
animate(cville_sf3a, fps = 1, detail = 1, nframes = 127)
```

```{r, results = "asis"}
meta %>%
  filter(varname == "Julpcp") %>% 
  select(about) %>% 
  as.list()
```

#### Warming Stripes Showing Precipitation in July for Each County for all Years 
```{r warming1b, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)

#select only the july temperature and year column
cville_sf3_jl <- select(cville_sf1, NAME, Year, Julpcp)

#rename the temperature column
cville_sf3_jl <- rename(cville_sf3_jl, ta = Julpcp)

```

```{r warming2b, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)

cville_sf3_jl <- mutate(cville_sf3_jl, date = str_c(Year, "01-01", sep = "-") %>% ymd())

```

```{r  warming3b, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)

cville_sf3_jlg <- filter(cville_sf3_jl, NAME == "Greene")
cville_sf3_jla <- filter(cville_sf3_jl, NAME == "Albemarle")
cville_sf3_jlc <- filter(cville_sf3_jl, NAME == "Charlottesville")
cville_sf3_jlf <- filter(cville_sf3_jl, NAME == "Fluvanna")
cville_sf3_jll <- filter(cville_sf3_jl, NAME == "Louisa")
cville_sf3_jln <- filter(cville_sf3_jl, NAME == "Nelson")
```

##### Greene County Warming Stripes: July Precipitation
```{r stripes1b,fig.width=10, fig.height=3, message=FALSE, warning=FALSE}
 ggplot(cville_sf3_jlg,
             aes(x = date, y = 1, fill = ta))+
        geom_tile()+
           scale_x_date(date_breaks = "6 years",
                     date_labels = "%Y",
                     expand = c(0, 0))+
           scale_y_continuous(expand = c(0, 0))+
           scale_fill_gradientn(colors = rev(col_strip))+
             guides(fill = guide_colorbar(barwidth = 1))+
            labs(title = "Greene County July Precipitation 1895-2020",
                caption = "Data: NOAA Surface Temperature Analysis")+
              theme_strip
```

##### Louisa County Warming Stripes: July Precipitation
```{r stripes2b,fig.width=10, fig.height=3, message=FALSE, warning=FALSE}
 ggplot(cville_sf3_jll,
             aes(x = date, y = 1, fill = ta))+
        geom_tile()+
           scale_x_date(date_breaks = "6 years",
                     date_labels = "%Y",
                     expand = c(0, 0))+
           scale_y_continuous(expand = c(0, 0))+
           scale_fill_gradientn(colors = rev(col_strip))+
             guides(fill = guide_colorbar(barwidth = 1))+
            labs(title = "Louisa County July Precipitation 1895-2020",
                caption = "Data: NOAA Surface Temperature Analysis")+
              theme_strip
```

##### Nelson County Warming Stripes: July Precipitation
```{r stripes3b,fig.width=10, fig.height=3, message=FALSE, warning=FALSE}
 ggplot(cville_sf3_jln,
             aes(x = date, y = 1, fill = ta))+
        geom_tile()+
           scale_x_date(date_breaks = "6 years",
                     date_labels = "%Y",
                     expand = c(0, 0))+
           scale_y_continuous(expand = c(0, 0))+
           scale_fill_gradientn(colors = rev(col_strip))+
             guides(fill = guide_colorbar(barwidth = 1))+
            labs(title = "Nelson County July Precipitation 1895-2020",
                caption = "Data: NOAA Surface Temperature Analysis")+
              theme_strip
```

##### Albemarle County Warming Stripes: July Precipitation
```{r stripes4b,fig.width=10, fig.height=3, message=FALSE, warning=FALSE}
 ggplot(cville_sf3_jla,
             aes(x = date, y = 1, fill = ta))+
        geom_tile()+
           scale_x_date(date_breaks = "6 years",
                     date_labels = "%Y",
                     expand = c(0, 0))+
           scale_y_continuous(expand = c(0, 0))+
           scale_fill_gradientn(colors = rev(col_strip))+
             guides(fill = guide_colorbar(barwidth = 1))+
            labs(title = "Albemarle County July Precipitation 1895-2020",
                caption = "Data: NOAA Surface Temperature Analysis")+
              theme_strip
```

##### Charlottesville County Warming Stripes: July Precipitation
```{r stripes5b,fig.width=10, fig.height=3, message=FALSE, warning=FALSE}
 ggplot(cville_sf3_jlc,
             aes(x = date, y = 1, fill = ta))+
        geom_tile()+
           scale_x_date(date_breaks = "6 years",
                     date_labels = "%Y",
                     expand = c(0, 0))+
           scale_y_continuous(expand = c(0, 0))+
           scale_fill_gradientn(colors = rev(col_strip))+
             guides(fill = guide_colorbar(barwidth = 1))+
            labs(title = "Charlottesville County Precipitation 1895-2020",
                caption = "Data: NOAA Surface Temperature Analysis")+
              theme_strip
```

##### Fluvanna County Warming Stripes: July Precipitation
```{r stripes6b,fig.width=10, fig.height=3, message=FALSE, warning=FALSE}
 ggplot(cville_sf3_jlf,
             aes(x = date, y = 1, fill = ta))+
        geom_tile()+
           scale_x_date(date_breaks = "6 years",
                     date_labels = "%Y",
                     expand = c(0, 0))+
           scale_y_continuous(expand = c(0, 0))+
           scale_fill_gradientn(colors = rev(col_strip))+
             guides(fill = guide_colorbar(barwidth = 1))+
            labs(title = "Fluvanna County July Precipitation 1895-2020",
                caption = "Data: NOAA Surface Temperature Analysis")+
              theme_strip
```


#### Average Yearly Precipitation across Counties

```{r}
cville_sf3b <- 
  ggplot(cville_sf1) +
  geom_sf(aes(fill = Avg_Temppcp), color = "black", alpha = .9, na.rm = TRUE) +
   geom_text_repel(data = cville_sf1, aes(X, Y, label = NAME), size = 4, nudge_x = 1, nudge_y = 0, fontface = "bold", hjust = 0.9) +
  scale_fill_fermenter(palette = "RdPu", direction = 1,   type = "seq", n.breaks = 6) +
     theme_void() +
  guides(fill =
           guide_colourbar(title.position="top", title.hjust = 0.5,
                           barwidth = 1)
  )  + 
  labs(fill = "Precipitation", title = 'Year: {frame_time}',
       caption = "Average Yearly Precipitation For Charlottesville Counties") + 
 transition_time(as.integer(Year)) +
ease_aes('linear') 
```

```{r}
animate(cville_sf3b, fps = 1, detail = 1, nframes = 127)
```


```{r, results = "asis"}
meta %>%
  filter(varname == "Avg_Temppcp") %>% 
  select(about) %>% 
  as.list()
```


#### Warming Stripes Showing Average Yearly Precipitation for Each County
```{r  warming6b, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)

#select only the annual temperature and year column
cville_sf3_yr <- select(cville_sf1, NAME, Year, Avg_Temppcp)

#rename the temperature column
cville_sf3_yr <- rename(cville_sf3_yr, ta = Avg_Temppcp)

```

```{r  warming7b, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)

cville_sf3_yr <- mutate(cville_sf3_yr, date = str_c(Year, "01-01", sep = "-") %>% ymd())

```

```{r warming8b, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)

cville_sf3_yrg <- filter(cville_sf3_yr, NAME == "Greene")
cville_sf3_yra <- filter(cville_sf3_yr, NAME == "Albemarle")
cville_sf3_yrc <- filter(cville_sf3_yr, NAME == "Charlottesville")
cville_sf3_yrf <- filter(cville_sf3_yr, NAME == "Fluvanna")
cville_sf3_yrl <- filter(cville_sf3_yr, NAME == "Louisa")
cville_sf3_yrn <- filter(cville_sf3_yr, NAME == "Nelson")
```

##### Greene County Warming Stripes: Average Yearly Precipitation
```{r stripes1ac,fig.width=10, fig.height=3,  message=FALSE, warning=FALSE}
 ggplot(cville_sf3_yrg,
             aes(x = date, y = 1, fill = ta))+
        geom_tile()+
           scale_x_date(date_breaks = "6 years",
                     date_labels = "%Y",
                     expand = c(0, 0))+
           scale_y_continuous(expand = c(0, 0))+
           scale_fill_gradientn(colors = rev(col_strip))+
             guides(fill = guide_colorbar(barwidth = 1))+
            labs(title = "Greene County Average Yearly Precipitation 1895-2020",
                caption = "Data: NOAA Surface Temperature Analysis")+
              theme_strip
```

##### Louisa County Warming Stripes: Average Yearly Precipitation
```{r stripes2ac,fig.width=10, fig.height=3, message=FALSE, warning=FALSE}
 ggplot(cville_sf3_yrl,
             aes(x = date, y = 1, fill = ta))+
        geom_tile()+
           scale_x_date(date_breaks = "6 years",
                     date_labels = "%Y",
                     expand = c(0, 0))+
           scale_y_continuous(expand = c(0, 0))+
           scale_fill_gradientn(colors = rev(col_strip))+
             guides(fill = guide_colorbar(barwidth = 1))+
            labs(title = "Louisa County Average Yearly Precipitation 1895-2020",
                caption = "Data: NOAA Surface Temperature Analysis")+
              theme_strip
```

##### Nelson County Warming Stripes: Average Yearly Precipitation
```{r stripes3ac,fig.width=10, fig.height=3, message=FALSE, warning=FALSE}
 ggplot(cville_sf3_yrn,
             aes(x = date, y = 1, fill = ta))+
        geom_tile()+
           scale_x_date(date_breaks = "6 years",
                     date_labels = "%Y",
                     expand = c(0, 0))+
           scale_y_continuous(expand = c(0, 0))+
           scale_fill_gradientn(colors = rev(col_strip))+
             guides(fill = guide_colorbar(barwidth = 1))+
            labs(title = "Nelson County Average Yearly Precipitation 1895-2020",
                caption = "Data: NOAA Surface Temperature Analysis")+
              theme_strip
```

##### Albemarle County Warming Stripes: Average Yearly Precipitation
```{r stripes4ac,fig.width=10, fig.height=3,  message=FALSE, warning=FALSE}
 ggplot(cville_sf3_yra,
             aes(x = date, y = 1, fill = ta))+
        geom_tile()+
           scale_x_date(date_breaks = "6 years",
                     date_labels = "%Y",
                     expand = c(0, 0))+
           scale_y_continuous(expand = c(0, 0))+
           scale_fill_gradientn(colors = rev(col_strip))+
             guides(fill = guide_colorbar(barwidth = 1))+
            labs(title = "Albemarle County Average Yearly Precipitation 1895-2020",
                caption = "Data: NOAA Surface Temperature Analysis")+
              theme_strip
```

##### Charlottesville County Warming Stripes: Average Yearly Precipitation
```{r stripes5ac,fig.width=10, fig.height=3, message=FALSE, warning=FALSE}
 ggplot(cville_sf3_yrc,
             aes(x = date, y = 1, fill = ta))+
        geom_tile()+
           scale_x_date(date_breaks = "6 years",
                     date_labels = "%Y",
                     expand = c(0, 0))+
           scale_y_continuous(expand = c(0, 0))+
           scale_fill_gradientn(colors = rev(col_strip))+
             guides(fill = guide_colorbar(barwidth = 1))+
            labs(title = "Charlottesville County Average Yearly Precipitation 1895-2020",
                caption = "Data: NOAA Surface Temperature Analysis")+
              theme_strip
```

##### Fluvanna County Warming Stripes: Average Yearly Precipitation
```{r stripes6ac,fig.width=10, fig.height=3, message=FALSE, warning=FALSE}
 ggplot(cville_sf3_yrf,
             aes(x = date, y = 1, fill = ta))+
        geom_tile()+
           scale_x_date(date_breaks = "6 years",
                     date_labels = "%Y",
                     expand = c(0, 0))+
           scale_y_continuous(expand = c(0, 0))+
           scale_fill_gradientn(colors = rev(col_strip))+
             guides(fill = guide_colorbar(barwidth = 1))+
            labs(title = "Fluvanna County Average Yearly Precipitation 1895-2020",
                caption = "Data: NOAA Surface Temperature Analysis")+
              theme_strip
```
